<!-- build time:Tue Oct 31 2023 21:50:08 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Sparkle" href="https://1234cas.github.io/1234cas.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Sparkle" href="https://1234cas.github.io/1234cas.github.io/atom.xml"><link rel="alternate" type="application/json" title="Sparkle" href="https://1234cas.github.io/1234cas.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="读书笔记"><link rel="canonical" href="https://1234cas.github.io/1234cas.github.io/Reading-minutes/js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D/"><title>js忍者秘籍 - 读书笔记 | Sparkle = Sparkle = 加油</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">js忍者秘籍</h1><div class="meta"><span class="item" title="创建时间：2023-05-15 10:40:05"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-05-15T10:40:05+08:00">2023-05-15</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>25k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>23 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Sparkle</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicliwyw55j20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giciukx8a7j20zk0m8aio.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclil3m4ej20zk0m8tn8.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclxp31goj20zk0m8qv5.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclj61ylzj20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipeun65urj20zk0m81ii.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Reading-minutes/" itemprop="item" rel="index" title="分类于 读书笔记"><span itemprop="name">读书笔记</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://1234cas.github.io/1234cas.github.io/Reading-minutes/js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="sparkle"><meta itemprop="description" content="加油, 好好读书"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sparkle"></span><div class="body md" itemprop="articleBody"><h1 id="第一章"><a class="anchor" href="#第一章">#</a> 第一章</h1><p>console.time () 计时器 cosole.timeEnd ()</p><h1 id="第三章-函数定义"><a class="anchor" href="#第三章-函数定义">#</a> 第三章 函数定义</h1><h2 id="函数"><a class="anchor" href="#函数">#</a> 函数</h2><p>JavaScript 中最关键的概念是：函数是第一类对象（first-class objects），或者说它们</p><p>被称作一等公民（first-class citizens）。</p><p>对象能做的任何一件事，函数也都能做。函数也是对象，唯一的特殊之处在于它是</p><p>可调用的（invokable），即函数会被调用以便执行某项动作。</p><p>把函数作为第一类对象是函数式编程（functional programming）的第一步。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>values<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value1<span class="token punctuation">,</span> value2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">return</span> value1 <span class="token operator">-</span> value2<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>任何类型的缓存都必然会为性能牺牲内存</p><h2 id="函数定义"><a class="anchor" href="#函数定义">#</a> 函数定义</h2><p>JavaScript 提供了几种定义函数的方式，可以分为 4 类。</p><ul><li><strong>函数定义（function declarations）和函数表达式（function expressions）</strong></li></ul><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> <span class="token function-variable function">fun</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul><li><strong>箭头函数（通常被叫做 lambda 函数）</strong></li></ul><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token parameter">num</span> <span class="token operator">=></span> num</pre></td></tr></table></figure><ul><li><strong>函数构造函数</strong></li></ul><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> fun <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><ul><li><strong>生成器函数</strong></li></ul><pre><code>function* gen()&#123; yield 1; &#125;
</code></pre><p>函数表达式的立即调用，立即调用函数（IIFE）</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>ES6 之前处理默认参数的方法</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">performAction</span><span class="token punctuation">(</span><span class="token parameter">ninja<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> action <span class="token operator">=</span> <span class="token keyword">typeof</span> action <span class="token operator">===</span> <span class="token string">"undefined"</span> <span class="token operator">?</span> <span class="token string">"skulking"</span> <span class="token operator">:</span> action<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">return</span> ninja <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> action<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>每次函数调用时都会从左到右求得参数的值，并且当对后面的默认参数赋值时可以引用前面的默认参数</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">performAction</span><span class="token punctuation">(</span>ninja<span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">"skulking"</span><span class="token punctuation">,</span> message <span class="token operator">=</span> ninja <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> action<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">return</span> message<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="小结"><a class="anchor" href="#小结">#</a> 小结</h2><blockquote><p>● 把 JavaScript 看作函数式语言你就能书写复杂代码。</p><p>● 作为第一类对象，函数和 JavaScript 中其他对象一样。类似于其他对象类型，函数具有以下功能。</p><p>​	♦ 通过字面量创建。</p><p>​	♦ 赋值给变量或属性。</p><p>​	♦ 作为函数参数传递。</p><p>​	♦ 作为函数的结果返回。</p><p>​	♦ 赋值给属性和方法。</p><p>● 回调函数是被代码随后 “回来调用” 的函数，它是一种很常用的函数，特别是在事件处理场景下。</p><p>● 函数具有属性，而且这些属性能够被存储任何信息，我们可以利用这个特性来做很多事情；例如：</p><p>​	♦ 可以在函数属性中存储另一个函数用于之后的引用和调用。</p><p>​	♦ 可以用函数属性创建一个缓存（记忆），用于减少不必要的计算。</p><p>● 有很多不同类型的函数：函数声明、函数表达式、箭头函数以及函数生成器等。</p><p>● 函数声明和函数表达式是两种最主要的函数类型。函数声明必须具有函数名，在代码中它也必须作为一个独立的语句存在。函数表达式可以不必有函数名，但此时它就必须作为其他语句的一部分。</p><p>● 箭头函数是 JavaScript 的一个新增特性，这个特性让我们可以使用更简洁的方式来定义函数。</p><p>● 形参是函数定义时列出的变量，而实参是函数调用时传递给函数的值。</p><p>● 函数的形参列表和实参列表长度可以不同。</p><p>​	♦ 未赋值的形参求值得到 undefined。</p><p>​	♦ 传入的额外实参不会被赋给任何一个命名形参。</p><p>● 剩余参数和默认参数是 JavaScript 的新特性。</p><p>​	♦ 剩余参数 —— 不与任何形参名相匹配的额外实参可以通过剩余参数来引用。</p><p>​	♦ 默认参数 —— 函数调用时，若没传入参数，默认参数可以给函数提供缺省的参数值。</p></blockquote><h1 id="第四章-函数调用"><a class="anchor" href="#第四章-函数调用">#</a> 第四章 函数调用</h1><h2 id="函数调用"><a class="anchor" href="#函数调用">#</a> 函数调用</h2><p>参数 this 表示被调用函数的上下文对象，而 arguments 参数表示函数调用过程中传递的所有参数。</p><p>函数调用：</p><ul><li><strong>作为一个函数 (function)——skulk ()，直接被调用。</strong></li></ul><p>通过全局函数（普通函数、立即执行函数、定时器）调用的 this 指向全局上下文（window 对象）在严格模式下指向 undefined</p><ul><li><strong>作为一个方法 (method)——ninja.skulk ()</strong></li></ul><p>通过方法调用函数时，this 指向该方法所在对象</p><p>（即便调用的是相同的函数，但通过 this 返回的函数上下文依然取决于该函数的调用方式）</p><ul><li><strong>作为一个构造函数 (constructor)——new Ninja ()</strong></li></ul><p>构造函数的目的是创建一个新对象，并初始化，然后将其作为构造函数的返回值</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220506201117776.png" alt="image-20220506201117776"></p><p>new 在执行时做的四件事：<strong>1. 在内存中创建一个新的空对象 2. 让 this 指向这个新对象 3. 执行构造函数里面的代码，给这个对象添加属性和方法 4. 返回这个新对象（所以构造函数里面不需要 return）</strong></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> puppet <span class="token operator">=</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> rules<span class="token operator">:</span> <span class="token boolean">false</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">function</span> <span class="token function">Emperor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">this</span><span class="token punctuation">.</span>rules <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">return</span> puppet<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">var</span> emperor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Emperor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>emperor <span class="token operator">===</span> puppet<span class="token punctuation">,</span> <span class="token string">"The emperor is merely a puppet!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>emperor<span class="token punctuation">.</span>rules <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">"The puppet does not know how to rule!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>如果构造函数返回一个对象，则该对象将作为整个表达式的值返回，而传入构造函数的 this 将被丢弃。</p><p>但是，如果构造函数返回的是非对象类型，则忽略返回值，返回新创建的对象。</p><ul><li><strong>call 或者 apply 方法 ——skulk.call (ninja)</strong></li></ul><figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Click Me!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"> </span></span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> 	<span class="token keyword">this</span><span class="token punctuation">.</span>clicked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> 	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">click</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> 		<span class="token keyword">this</span><span class="token punctuation">.</span>clicked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> 		<span class="token function">assert</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span>clicked<span class="token punctuation">,</span> <span class="token string">"The button has been clicked"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> 	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">var</span> button <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token keyword">var</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> button<span class="token punctuation">.</span>click<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token comment">// 把 button.click 直接替换成函数就可以很清楚的看到 this 指向问题</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>因此上下文将是 &lt;button&gt; 元素，而非 button 对象。所以我们将单击状态设置到了错误的对象上</p><p>apply 和 call 可以显式的指定任意对象作为函数的上下文</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">String</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>上下文<span class="token punctuation">,</span> 实参<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>sparkle<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>解决函数上下文的问题：箭头函数，bind 方法</p><h2 id="小结-2"><a class="anchor" href="#小结-2">#</a> 小结</h2><blockquote><p>● 当调用函数时，除了传入在函数定义中显式声明的参数之外，同时还传入两个</p><p>隐式参数：arguments 与 this。</p><p>- arguments 参数是传入函数的所有参数的集合。具有 length 属性，表示传入</p><p>参数的个数，通过 arguments 参数还可获取那些与函数形参不匹配的参数。</p><p>在非严格模式下，arguments 对象是函数参数的别名，修改 arguments 对象</p><p>会修改函数实参，可以通过严格模式避免修改函数实参。</p><p>- this 表示函数上下文，即与函数调用相关联的对象。函数的定义方式和调用</p><p>方式决定了 this 的取值。</p><p>● 函数的调用方式有 4 种。</p><p>- 作为函数调用：skulk ()。</p><p>- 作为方法调用：ninja.skulk ()。</p><p>- 作为构造函数调用：new Ninja ()。</p><p>- 通过 apply 与 call 方法调用：skulk.apply (ninja) 或 skulk.call (ninja)。</p><p>● 函数的调用方式影响 this 的取值。</p><p>- 如果作为函数调用，在非严格模式下，this 指向全局 window 对象；在严格</p><p>模式下，this 指向 undefined。</p><p>- 作为方法调用，this 通常指向调用的对。</p><p>- 作为构造函数调用，this 指向新创建的对象。</p><p>- 通过 call 或 apply 调用，this 指向 call 或 apply 的第一个参数。</p><p>● 箭头函数没有单独的 this 值，this 在箭头函数创建时确定。</p><p>● 所有函数均可使用 bind 方法，创建新函数，并绑定到 bind 方法传入的参数上。</p><p>被绑定的函数与原始函数具有一致的行为</p></blockquote><h1 id="第五章-闭包和作用域"><a class="anchor" href="#第五章-闭包和作用域">#</a> 第五章 闭包和作用域</h1><h2 id="闭包"><a class="anchor" href="#闭包">#</a> 闭包</h2><p>闭包带来的问题是 JS 的作用域是如何工作的</p><p><strong>闭包允许函数访问并操作函数外部的变量。</strong>（作用域是程序的一部分，特定的名字绑定特定的变量。）</p><p>所声明的函数可以在声明之后的任何时间被调用，甚至当该函数声明的作用域消失之后仍然可以调用。</p><p>当在外部函数中声明内部函数时，不仅定义了函数的声明，而且还创建了一个闭包。该闭包不仅包含了函数的声明，<strong>还包含了在函数声明时该作用域中的所有变量</strong>。当最终执行内部函数时，尽管声明时的作用域已经消失了，但是通过闭包，仍然能够访问到原始作用域</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220506211944366.png" alt="image-20220506211944366"></p><p>通过使用闭包，我们可以实现很接近的、可接受的私有变量</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Ninja</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">var</span> feints <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getFeints</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">return</span> feints<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">feint</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre> 	feints<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">var</span> ninja1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ninja</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>ninja1<span class="token punctuation">.</span><span class="token function">feint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">.</span>feints <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span><span class="token string">"And the private data is inaccessible to us."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">.</span><span class="token function">getFeints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"We're able to access the internal feint count."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220506212223096.png" alt="image-20220506212223096"></p><ul><li><p>通过变量 ninja，对象实例是可见的。</p></li><li><p>因为 feint 方法在闭包内部，因此可以访问变量 feints。</p></li><li><p>在闭包外部，我们无法访问变量 feints。</p></li></ul><p>通过在函数内部定义变量，并基于闭包，使得在计时器的回调函数中可以访问这些变量，每个动画都能够获得属于自己的 “气泡” 中的私有变量。可以一次性做到许多事情。</p><h2 id="执行上下文"><a class="anchor" href="#执行上下文">#</a> 执行上下文</h2><p>JS 引擎执行代码时，每一条语句都处于特定的执行上下文中，全局执行上下文只有一个，当 JavaScript 程序开始执行时就已经创建了全局上下文；而函数执行上下文是在每次调用函数时，就会创建一个新的。</p><p>（执行上下文是内部的 JavaScript 概念，JavaScript 引擎使用执行上下文来跟踪函数的执行。可以在调试器中看到对应的调用栈 (call stack)）</p><p>JavaScript 基于单线程的执行模型：在某个特定的时刻只能执行特定的代码。一旦发生函数调用，当前的执行上下文必须停止执行，并创建新的函数执行上下文来执行函数。当函数执行完成后，将函数执行上下文销毁，并重新回到发生调用时的执行上下文中。所以需要跟踪执行上下文 —— 正在执行的上下文以及正在等待的上下文。最简单的跟踪方法是使用执行上下文栈（或称为调用栈）</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220506213426843.png" alt="image-20220506213426843"></p><h2 id="词法环境"><a class="anchor" href="#词法环境">#</a> 词法环境</h2><p><strong>词法环境（lexical environment）是 JavaScript 引擎内部用来跟踪标识符与特定变量之间的映射关系。</strong></p><p>（词法环境是 JavaScript 作用域的内部实现机制，人们通常称为作用域 (scopes)）</p><p>因为我们需要访问外部代码结构中的变量，如果在当前环境中无法找到某一标识符，就会对外部环境进行查找。一旦查找到匹配的变量，或是在全局环境中仍然无法查找到对应的标识符而返回错误，就会停止查找。</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220506213818422.png" alt="image-20220506213818422"></p><p>无论何时调用函数，都会创建一个新的执行环境，被推入执行上下文栈。此外，还会创建一个与之相关联的词法环境。现在来看最重要的部分：外部环境与新建的词法环境，JavaScript 引擎将调用函数的内置 [[Environment]] 属性与创建函数时的环境进行关联。</p><h2 id="变量类型"><a class="anchor" href="#变量类型">#</a> 变量类型</h2><p>const 只能在声明时被初始化一次，不允许重新赋值，可以修改 const 变量已经存在的值，但不能重写</p><p>var 在最近的函数或者是全局词法环境中定义变量（无视块级作用域）</p><p>let 和 const 直接在最近的词法环境中定义变量</p><p><strong>JavaScript 代码的执行事实上是分两个阶段进行的。</strong></p><p>一旦创建了新的词法环境，就会执行第一阶段。** 在第一阶段，没有执行代码，但是 JavaScript 引擎会访问并注册在当前词法环境中所声明的变量和函数。**JavaScript 在第一阶段完成之后开始执行第二阶段，具体如何执行取决于变量的类型（let、var、const 和函数声明）以及环境类型（全局环境、函数环境或块级作用域）。</p><p>具体的处理过程如下：</p><p>1．如果是创建一个函数环境，那么创建形参及函数参数的默认值。如果是非函数环境，将跳过此步骤。</p><p>2．如果是创建全局或函数环境，就扫描当前代码进行函数声明（不会扫描其他函数的函数体），但是不会执行函数表达式或箭头函数。对于所找到的函数声明，将创建函数，并绑定到当前环境与函数名相同的标识符上。若该标识符已经存在，那么该标识符的值将被重写。如果是块级作用域，将跳过此步骤。</p><p>3．扫描当前代码进行变量声明。在函数或全局环境中，查找所有当前函数以及其他函数之外通过 var 声明的变量，并查找所有通过 let 或 const 定义的变量。在块级环境中，仅查找当前块中通过 let 或 const 定义的变量。对于所查找到的变量，若该标识符不存在，进行注册并将其初始化为 undefined。若该标识符已经存在，将保留其值</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220506214501998.png" alt="image-20220506214501998"></p><p>需要注意的是，变量提升仅针对函数声明有效。函数表达式与箭头函数都不在此过程中，而是在程序执行过程（第二阶段）中执行定义的。</p><p><strong>变量提升 (variable hoisting) ：<strong>变量和函数的声明并没有实际发生移动。只是在</strong>代码执行之前</strong>，先在词法环境中进行注册。</p><h2 id="闭包工作原理"><a class="anchor" href="#闭包工作原理">#</a> 闭包工作原理</h2><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Ninja</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">var</span> feints <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getFeints</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> 	<span class="token keyword">return</span> feints<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">feint</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre> 	feints<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">var</span> ninja1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ninja</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">.</span>feints <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token string">"And the private data is inaccessible to us."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>ninja1<span class="token punctuation">.</span><span class="token function">feint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">.</span><span class="token function">getFeints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"We're able to access the internal feint count."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">var</span> ninja2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ninja</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>ninja2<span class="token punctuation">.</span><span class="token function">getFeints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"The second ninja object gets its own feints variable."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在调用 ninja2.getFeints 方法之前，JavaScript 引擎正在执行全局代码。我们的程序处于全局执行上下文状态，是执行栈里的唯一上下文。同时，唯一活跃的词法环境是全局环境，与全局执行上下文关联。</p><p><strong>当调用 ninja2.getFeints () 时，我们调用的是 ninja2 对象的 getFeints 方法。由于每次调用函数时均会创建新的执行上下文，因此创建了新的 getFeints 执行环境并推入执行栈。这同时引起创建新的词法环境，词法环境通常用于保持跟踪函数中定义的变量。另外，getFeints 词法环境包含了 getFeints 函数被创建时所处的环境，当 ninja2 对象构建时，Ninja 环境是活跃的。</strong></p><p>现在我们了解了试图获取 feints 变量时是如何工作的。首先，访问活跃的 getFeints 词法环境。因为在 getFeints 函数内部未定义任何变量，该词法环境是空的，找不到 feints 变量。接下来，在当前词法环境的外部环境进行查找 —— 本例中，当创建 ninja2 对象时，Ninja 环境处于活跃状态。Ninja 环境中具有 feints 变量的引用，完成搜索过程，就是那么简单。</p><p>我们理解了在处理闭包时，执行上下文与词法环境所扮演的角色</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220506215543085.png" alt="image-20220506215543085"></p><h2 id="小结-3"><a class="anchor" href="#小结-3">#</a> 小结</h2><blockquote><p>● 通过闭包可以访问创建闭包时所处环境中的全部变量。闭包为函数创建时所处</p><p>​	的作用域中的函数和变量，创建 “安全气泡”。通过这种的方式，即使创建函数</p><p>​	时所处的作用域已经消失，但是函数仍然能够获得执行时所需的全部内容。</p><p>● 我们可以使用闭包的这些高级功能：</p><p>​	- 通过构造函数内的变量以及构造方法来模拟对象的私有属性。</p><p>​	- 处理回调函数，简化代码。</p><p>● JavaScript 引擎通过执行上下文栈（调用栈）跟踪函数的执行。每次调用函数时，</p><p>​	都会创建新的函数执行上下文，并推入调用栈顶端。当函数执行完成后，对应</p><p>​	的执行上下文将从调用栈中推出。</p><p>● JavaScript 引擎通过词法环境跟踪标识符（俗称作用域）。</p><p>● 在 JavaScript 中，我们可以定义全局级别、函数级别甚至块级别的变量。</p><p>● 可以使用关键字 var、let 与 const 定义变量：</p><p>​	- 关键字 var 定义距离最近的函数级变量或全局变量。</p><p>​	- 关键字 let 与 const 定义距离最近级别的变量，包括块级变量。块级变量在</p><p>​	ES6 之前版本的 JavaScript 中是无法实现的。此外，通过关键字 const 允许</p><p>​	定义只能赋值一次的变量。</p><p>● 闭包是 JavaScript 作用域规则的副作用。当函数创建时所在的作用域消失后，仍</p><p>​	然能够调用函数。</p></blockquote><h1 id="第六章-生成器和promise"><a class="anchor" href="#第六章-生成器和promise">#</a> 第六章 生成器和 promise</h1><h2 id="生成器"><a class="anchor" href="#生成器">#</a> 生成器</h2><p>从服务器中获取数据是一个长时间操作，而 JavaScript 依赖于单线程执行模型，所以一直到长时间的操作结束之前，UI 的渲染都会暂停。随后的应用都会无响应，用户会感到不满。我们可以用回调函数解决这个问题，这样每个任务结束后都调用回调函数，从而不会导致 UI 暂停。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">WeaponGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">yield</span> <span class="token string">"Katana"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">yield</span> <span class="token string">"Wakizashi"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">const</span> weaponsIterator <span class="token operator">=</span> <span class="token function">WeaponGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> result1 <span class="token operator">=</span> weaponsIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> result1 <span class="token operator">===</span> <span class="token string">"object"</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token operator">&amp;&amp;</span> result1<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">"Katana"</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>result1<span class="token punctuation">.</span>done<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token string">"Katana received!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">const</span> result2 <span class="token operator">=</span> weaponsIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> result2 <span class="token operator">===</span> <span class="token string">"object"</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token operator">&amp;&amp;</span> result2<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">"Wakizashi"</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>result2<span class="token punctuation">.</span>done<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token string">"Wakizashi received!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">const</span> result3 <span class="token operator">=</span> weaponsIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> result3 <span class="token operator">===</span> <span class="token string">"object"</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token operator">&amp;&amp;</span> result3<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token operator">&amp;&amp;</span> result3<span class="token punctuation">.</span>done<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token string">"There are no more results!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>生成器（generator）函数能生成一组值的序列，但每个值的生成是基于每次请求。</p><p>创建一个生成器函数非常简单：仅仅需要在关键字 function 后面加上一个星号（*）。这样一来生成器函数体内就能够使用新关键字 yield，从而生成独立的值。</p><p>调用生成器后，就会<strong>创建一个迭代器（iterator）</strong>：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> weaponsIterator <span class="token operator">=</span> <span class="token function">WeaponGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>迭代器用于控制生成器的执行。迭代器对象暴露的最基本接口是 next 方法。这个方法可以用来向生成器请求一个值，从而控制生成器：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> result1 <span class="token operator">=</span> weaponsIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>当第三次执行 next 方法后生成器返回一个结果对象，属性 value 被置为 undefined，属性 done 被置为 true，表明它的工作已经完成了</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>item <span class="token operator">=</span> weaponsIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token function">assert</span><span class="token punctuation">(</span>item <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>value<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这就是第一个生成器示例中 for-of 循环的原理。for-of 循环不过是对迭代器进行迭代的语法糖。</p><p>用生成器生成 ID 序列</p><figure class="highlight js"><figcaption data-lang="JavaScript"><span>用生成器生成 ID 序列</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">IdGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">yield</span> <span class="token operator">++</span>id<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> idIterator <span class="token operator">=</span> <span class="token function">IdGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> ninja1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> idIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">const</span> ninja2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> idIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">const</span> ninja3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> idIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"First ninja has id 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>ninja2<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Second ninja has id 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>ninja3<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"Third ninja has id 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>使用迭代器遍历 DOM 树</p><figure class="highlight js"><figcaption data-lang="JavaScript"><span>使用迭代器遍历 DOM 树</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">DomTraversal</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">yield</span> element<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> element <span class="token operator">=</span> element<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">while</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">DomTraversal</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> element <span class="token operator">=</span> element<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">const</span> subTree <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"subTree"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> element <span class="token keyword">of</span> <span class="token function">DomTraversal</span><span class="token punctuation">(</span>subTree<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token function">assert</span><span class="token punctuation">(</span>element <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">,</span> element<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="与生成器交互"><a class="anchor" href="#与生成器交互">#</a> 与生成器交互</h3><p>使用 next 方法向生成器发送值</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">NinjaGenerator</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">const</span> imposter <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">"Hattori "</span> <span class="token operator">+</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token function">assert</span><span class="token punctuation">(</span>imposter <span class="token operator">===</span> <span class="token string">"Hanzo"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token string">"The generator has been infiltrated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">yield</span> <span class="token punctuation">(</span><span class="token string">"Yoshi ("</span> <span class="token operator">+</span> imposter <span class="token operator">+</span> <span class="token string">") "</span> <span class="token operator">+</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> ninjaIterator <span class="token operator">=</span> <span class="token function">NinjaGenerator</span><span class="token punctuation">(</span><span class="token string">"skulk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> result1 <span class="token operator">=</span> ninjaIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>result1<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">"Hattori skulk"</span><span class="token punctuation">,</span><span class="token string">"Hattori is skulking"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">const</span> result2 <span class="token operator">=</span> ninjaIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">"Hanzo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>result2<span class="token punctuation">.</span>value <span class="token operator">===</span> "<span class="token function">Yoshi</span> <span class="token punctuation">(</span>Ha</pre></td></tr></table></figure><p>我们通过 yield 语句从生成器中返回值，再使用迭代器的 next () 方法把值传回生成器。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> result2 <span class="token operator">=</span> ninjaIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">"Hanzo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>注意：next 方法为等待中的 yield 表达式提供了值，所以，如果没有等待中的 yield 表达式，也就没有什么值能应用的。基于这个原因，我们无法通过第一次调用 next 方法来向生成器提供该值。 但记住，如果你需要为生成器提供一个初始值，你可以调用生成器自身，就像 NinjaGenerator (&quot;skulk&quot;)。</p><h3 id="生成器内部构造"><a class="anchor" href="#生成器内部构造">#</a> 生成器内部构造</h3><p>在某种方面来说，生成器的工作更像是一个小程序，一个在状态中运动的状态机</p><ul><li><p>挂起开始 —— 创建了一个生成器后，它最先以这种状态开始。其中的任何代码都未执行。</p></li><li><p>执行 —— 生成器中的代码已执行。执行要么是刚开始，要么是从上次挂起的时候继续的。当生成器对应的迭代器调用了 next 方法，并且当前存在可执行的代码时，生成器都会转移到这个状态。</p></li><li><p>挂起让渡 —— 当生成器在执行过程中遇到了一个 yield 表达式，它会创建一个包含着返回值的新对象，随后再挂起执行。生成器在这个状态暂停并等待继续 执行。</p></li><li><p>完成 —— 在生成器执行期间，如果代码执行到 return 语句或者全部代码执行完毕，生成器就进入该状态。</p></li></ul><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220507150003674.png" alt="image-20220507150003674"></p><h3 id="通过执行上下文跟踪生成器函数"><a class="anchor" href="#通过执行上下文跟踪生成器函数">#</a> 通过执行上下文跟踪生成器函数</h3><p>由于正在执行的是全局代码，故执行上下文栈仅仅包含全局执行上下文，该上下文引用了当前标识符所在的全局环境。而 NinjaGenerator 则仅仅引用了一个函数，此时其他标识符的值都是 undefined。</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220507150211093.png" alt="image-20220507150211093"></p><p>当我们调用 NinjaGenerator 函数：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> ninjaIterator <span class="token operator">=</span> <span class="token function">NinjaGenerator</span><span class="token punctuation">(</span><span class="token string">"skulk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>由于迭代器是用来控制生成器的执行的，故而迭代器中保存着一个在它创建位置处的执行上下文。</p><p>一般情况下，当程序从一个标准函数返回后，对应的执行环境上下文会从栈中弹出，并被完整地销毁。但在生成器中不是这样。</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220507150306016.png" alt="image-20220507150306016"></p><p>当调用迭代器的 next 方法时发生了另一件有趣的事：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> result1 <span class="token operator">=</span> ninjaIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>迭代器保持了一个对当前执行环境的引用，保证只要迭代器还需要它的时候它都存在。</p><p>它会重新激活对应的执行上下文。在这个例子中，是 NinjaGenerator 上下文，并把该上下文放入栈的顶部，从它上次离开的地方继续执行</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220507150539776.png" alt="image-20220507150539776"></p><p>当生成器函数运行到这个位置的时候，又会发生一件有趣的事：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">yield</span> <span class="token string">"Hattori "</span> <span class="token operator">+</span> action</pre></td></tr></table></figure><p>发生了一件类似前面的事情：NinjaGenerator 上下文离开了调用栈，但由于 ninjaIterator 还持有着对它的引用，故而它并未被销毁。现在生成器挂起了，又在非阻塞的情况下移动到了挂起让渡状态。</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220507150426153.png" alt="image-20220507150426153"></p><p>我们深入挖掘生成器的工作原理后可以发现，生成器所有不可思议的特点实际都来源于一点，<strong>即当我们从生成器中取得控制权后，生成器的执行环境上下文一直是保存的，而不是像标准函数一样退出后销毁。</strong></p><h2 id="promise"><a class="anchor" href="#promise">#</a> Promise</h2><p>使用 JavaScript 编写代码会大量的依赖异步计算，计算那些我们现在不需要但将来某时候可能需要的值。</p><p><strong>promise 对象是对我们现在尚未得到但将来会得到值的占位符</strong>；它是对我们最终能够得知异步计算结果的一种保证。如果我们兑现了我们的承诺，那结果会得到一个值。如果发生了问题，结果则是一个错误，一个为什么不能交付的借口。（使用 promise 的一个最佳例子是从服务器获取数据：我们要承诺最终会拿到数据，但其实总有可能发生错误。）</p><p>创建一个简单的 promise</p><figure class="highlight js"><figcaption data-lang="JavaScript"><span>创建一个简单的 promise</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> ninjaPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"Hattori"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token comment">//reject("An error resolving a promise!"); </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>ninjaPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">ninja</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token function">assert</span><span class="token punctuation">(</span>ninja <span class="token operator">===</span> <span class="token string">"Hattori"</span><span class="token punctuation">,</span> <span class="token string">"We were promised Hattori!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">"There shouldn't be an error"</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>创建一个 promise 需要传入一个函数。这个函数被称为执行函数（executor function），它包含两个参数 <code>resolve</code> 和 <code>reject</code> 。<strong>我们可以手动调用 resolve 让承诺兑现，也可以当错误发生时手动调用 reject。</strong></p><h3 id="简单回调函数的问题"><a class="anchor" href="#简单回调函数的问题">#</a> 简单回调函数的问题</h3><p>使用异步代码的原因在于不希望在执行长时间任务的时候，应用程序的执行被阻塞（影响用户体验）。</p><p>第一个问题：错误难以处理。</p><p>第二个问题：执行连续步骤非常棘手。</p><p>第三个问题：执行很多并行任务也很棘手。</p><h3 id="深入研究promise"><a class="anchor" href="#深入研究promise">#</a> 深入研究 Promise</h3><p>一个 promise 对象从等待（pending）状态开始，此时我们对承诺的值一无所知。因此一个等待状态的 promise 对象也称为未实现（unresolved） 的 promise。</p><p>在程序执行的过程中，如果 promise 的 resolve 函数被调用，promise 就会进入完成（fulfilled）状态，在该状态下我们能够成功获取到承诺的值。</p><p>另一方面，如果 promise 的 reject 函数被调用，或者如果一个未处理的异常在 promise 调用的过程中发生了，promise 就会进入到拒绝状态，尽管在该状态下我们无法获取承诺的值，但我们至少知道了原因。</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220507152645117.png" alt="image-20220507152645117"></p><p>一旦某个 promise 进入到完成态或者拒绝态，它的状态都不能再切换了（一个 promise 对象无法从完成态再进入拒绝态或者相反）</p><h3 id="拒绝promise"><a class="anchor" href="#拒绝promise">#</a> 拒绝 Promise</h3><p>拒绝一个 promise 有两种方式：显式拒绝，即在一个 promise 的执行函数中调用传入的 reject 方法；隐式拒绝，正处理一个 promise 的过程中抛出了一个异常。</p><p>通过调用传入的 reject 函数可以显式拒绝 promise：reject (&quot;Explicitly reject a promise!&quot;)。如果 promise 被拒绝，则第二个回调函数 error 总会被调用。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">"Explicitly reject a promise!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">"Happy path, won't be called!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">pass</span><span class="token punctuation">(</span><span class="token string">"Promise was also rejected"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>除此之外可以使用替代预发来处理拒绝 promise，通过使用内置的 catch 方法</p><h3 id="promise案例"><a class="anchor" href="#promise案例">#</a> Promise 案例</h3><figure class="highlight js"><figcaption data-lang="JavaScript"><span>Promise案例</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>      request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      request<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>          <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">"data/ninjas.json"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">ninjas</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token function">assert</span><span class="token punctuation">(</span>ninjas <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"Ninjas obtained!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">"Shouldn't be here:"</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>本例中有 3 个潜在的错误源：客户端和服务器之间的连接错误、服务器返回错误的数据（无效响应状态码），以及无效的 JSON 代码。但从使用了 getJSON 函数的角度来说，我们不必关心错误源的种类。我们只需提供一个回调函数，当一切正常工作且数据也正确返回时触发该回调函数，并提供另一个回调函数，当任何错误发生时触发该回调函数。这种方式能减轻开发者的工作量。</p><h2 id="生成器和promise结合"><a class="anchor" href="#生成器和promise结合">#</a> 生成器和 Promise 结合</h2><p>async 的大概实现</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token keyword">const</span> ninjas <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">"data/ninjas.json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token keyword">const</span> missions <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getJSON</span><span class="token punctuation">(</span>ninjas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>missionsUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token keyword">const</span> missionDescription <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getJSON</span><span class="token punctuation">(</span>missions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>detailsUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token comment">//Study the mission details </span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token comment">//Oh no, we weren't able to get the mission details </span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">function</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">generator</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">var</span> iterator <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter">iteratorResult</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>iteratorResult<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token keyword">const</span> iteratorValue <span class="token operator">=</span> iteratorResult<span class="token punctuation">.</span>value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>iteratorValue <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        iteratorValue<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token function">handle</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>          <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> iterator<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token function">handle</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> iterator<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>● 函数是第一类对象 —— 我们向 async 函数传入了一个参数，该参数也是函数。</p><p>● 生成器函数 —— 用它的特性来挂起和恢复执行。</p><p>● promise—— 帮我们处理异步代码。</p><p>● 回调函数 —— 在 promise 对象上注册成功和失败的回调函数。</p><p>● 箭头函数 —— 箭头函数的简洁适合用在回调函数上</p><p>● 闭包 —— 在我们控制生成器的过程中，迭代器在 async 函数内被创建，随之我们</p><p>在 promise 的回调函数内通过闭包来获取该迭代器</p><h2 id="小结-4"><a class="anchor" href="#小结-4">#</a> 小结</h2><blockquote><p>● 生成器是一种不会在同时输出所有值序列的函数，而是基于每次的请求生成值。</p><p>● 不同于标准函数，生成器可以挂起和回复它们的执行状态。当生成器生成了一个值后，它将会在不阻塞主线程的基础上挂起执行，随后静静地等待下次请求。</p><p>● 生成器通过在 function 后面加一个星号（*）来定义。在生成器函数体内，我们可以使用新的关键字 yield 来生成一个值并挂起生成器的执行。如果我们想让渡到另一个生成器中，可以使用 yield 操作符。</p><p>● 在我们控制生成器的执行过程中，通过使用迭代器的 next 方法调用一个生成器，它能够创建一个迭代器对象。除此之外，我们还能够通过 next 函数向生成器中传入值。</p><p>● promise 是计算结果值的一个占位符，它是对我们最终会得到异步计算结果的一个保证。promise 既可以成功也可以失败，一旦设定好了，就不能够有更多改变。</p><p>● promise 显著地简化了我们处理异步代码的过程。通过使用 then 方法来生成 promise 链，我们就能轻易地处理异步时序依赖。并行执行多个异步任务也同样简单：仅使用 Promise.all 方法即可。</p><p>● 通过将生成器和 promise 相结合我们能够使用同步代码来简化异步任务。</p></blockquote><h1 id="第七章-面向对象和原型"><a class="anchor" href="#第七章-面向对象和原型">#</a> 第七章 面向对象和原型</h1><h2 id="原型"><a class="anchor" href="#原型">#</a> 原型</h2><p>在 JavaScript 中，对象的原型属性是内置属性（使用标记 [[prototype]]），无法直接访问。相反，内置的方法 Object.setPrototypeOf 需要传入两个对象作为参数，并将第二个对象设置为第一个对象的原型。例如，执行语句 Object.setPrototypeOf (yoshi, hattori);， 将 yoshi 的原型设置为 hattori。</p><p>当访问对象上不存在的属性时，将查询对象的原型。</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220507154511784.png" alt="image-20220507154511784"></p><p>需要特别强调的是，每个对象都可以有一个原型，每个对象的原型也可以拥有一个原型，以此类推，形成一个原型链。查找特定属性将会被委托在整个原型链上，只有当没有更多的原型可以进行查找时，才会停止查找。</p><p>● 每一个函数都具有一个原型对象。</p><p>● 每一个函数的原型都具有一个 constructor 属性，该属性指向函数本身。</p><p>● constructor 对象的原型设置为新创建的对象的原型</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220507154607720.png" alt="image-20220507154607720"></p><p>我们创建的每一个函数都具有一个新的原型对象。当我们将一个函数作为构造函数使用时，构造器的原型对象将被设置为函数的原型</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220507154705602.png" alt="image-20220507154705602"></p><p>每个 ninja 实例都有自己的属性版本，这些属性在构造器内创建，并且均可访问相同的原型属性。</p><p>只创建几个对象影响不大，但是如果创建大量的对象时就需要引起注意了。因为每个复制的方法都一样，创建大量的无意义复制文件，仅仅是占用内存而已。</p><p>注意：回忆第 5 章中提到的闭包：在构造函数内部定义方法，使得我们可以模仿私有对象变量。如果我们需要私有对象，在构造函数内指定方法是唯一的解决方案</p><p>对象与函数原型之间的引用关系是在对象创建时建立的。新创建的对象将引用新的原型。</p><p>通过使用 constructor 属性，我们可以访问创建该对象时所用的函数。这个特性可以用于类型校验。</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220507154917216.png" alt="image-20220507154917216"></p><p>由于 constructor 属性仅仅是原始构造函数的引用，因此我们可以使用该属性创建新的 Ninja 对象。</p><p>通过执行 instanceof 操作符，我们可以判定函数是否继承原型链上的对象功能。</p><p>注意：强烈不建议使用，就是直接使用 Person 的原型对象作为 Ninja 的原型，如 Ninja.prototype = Person.prototype。这样做会导致在 Person 原型上所发生的所有变化都被同步到 Ninja 原型上（Person 原型与 Ninja 原型是同一个对象）。</p><p>尽管 instanceof 操作符最常见的用途就是提供一个清晰的方法来确定一个实例是否是由一个特定的构造函数创建的，但并不完全是这样。事实上，它会检查操作符右边的函数的原型是否存在于操作符左边的对象的原型链上。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">dance</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">function</span> <span class="token function">Ninja</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">Ninja</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Ninja</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">"constructor"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> value<span class="token operator">:</span> Ninja<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> writable<span class="token operator">:</span> <span class="token boolean">true</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">var</span> ninja <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ninja</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="小结-5"><a class="anchor" href="#小结-5">#</a> 小结</h2><blockquote><p>● JavaScript 对象是属性名与属性值的集合。</p><p>● JavaScript 使用原型。</p><p>● 每个对象上都具有原型的引用，搜索指定的属性时，如果对象本身不存在该属性，则可以代理到原型上进行搜索。对象的原型也可以具有原型，以此类推，形成原型链。</p><p>● 可以通过 Object.setPrototypeOf 方法定义对象的原型。</p><p>● 原型与构造函数密切相关。每个函数都具有原型属性，该函数创建的对象的原型，就是函数本身。</p><p>● 函数原型对象具有 constructor 属性，该属性指向函数本身。该函数创建的全部对象均访问该属性，constructor 属性还可用于判断对象是否是由指定的函数创建的。</p><p>● 在 JavaScript 中，几乎所有的内容在运行时都会发生变化，包括对象的原型和函数的原型。</p><p>● 如果我们希望 Ninja 构造函数创建的实例都可以 “继承”（更准确地说，可以访问）Person 构造函数的属性，那么，将 Ninja 构造函数的原型设置为 Person 类的实例。</p><p>● 在 JavaScript 中，原型具有属性（如 configurable、enumerable、writable）。这些属性可通过内置的 Object.defineProperty 方法进行定义。</p><p>● JavaScript ES6 引入关键字 class，使得我们可以更方便地实现模拟类。在底层仍然是使用原型实现的。</p><p>● 使用 extends 可以更优雅地实现继承。</p></blockquote><h1 id="第八章-控制对象的访问"><a class="anchor" href="#第八章-控制对象的访问">#</a> 第八章 控制对象的访问</h1><h2 id="getter-和-setter"><a class="anchor" href="#getter-和-setter">#</a> getter 和 setter</h2><p>用于访问普通数据属性，同时可以计算属性值、校验属性值，或其他我们想做的事</p><p>● 通过对象字面量定义，或在 ES6 的 class 中定义。</p><p>● 通过使用内置的 Object.defineProperty 方法。</p><p>对象字面量定义</p><figure class="highlight js"><figcaption data-lang="JavaScript"><span>对象字面量定义</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> ninjaCollection <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    ninjas<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Yoshi"</span><span class="token punctuation">,</span> <span class="token string">"Kuma"</span><span class="token punctuation">,</span> <span class="token string">"Hattori"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">get</span> <span class="token function">firstNinja</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">"Getting firstNinja"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ninjas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">set</span> <span class="token function">firstNinja</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">"Setting firstNinja"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token keyword">this</span><span class="token punctuation">.</span>ninjas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220517195515177.png" alt="image-20220517195515177"></p><p>可以通过原生的 getter 和 setter 设置标准属性，但是这些方法是在访问属性时立即执行的。</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220517195704382.png" alt="image-20220517195704382"></p><p>针对指定的属性不一定需要同时定义 getter 和 setter。例如，通常我们仅提供 getter。如果在某些情况下需要写入属性值，具体的行为取决于代码是在严格模式还是非严格模式。如果在非严格模式下，对仅有 getter 的属性赋值不起作用，JavaScript 引擎默默地忽略我们的请求。另一方面，如果在严格模式下，JavaScript 引擎将会抛出异常，表明我们试图将给一个仅有 getter 没有 setter 的属性赋值。</p><p>通过 Object.defineProperty 定义 getter 和 setter</p><figure class="highlight js"><figcaption data-lang="JavaScript"><span>通过 Object.defineProperty 定义 getter 和 setter</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Ninja</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> _skillLevel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'skillLevel'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">"The get method is called"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> _skillLevel<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">"The set method is called"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        _skillLevel <span class="token operator">=</span> value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">const</span> ninja <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ninja</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="使用-getter-与-setter-校验属性值"><a class="anchor" href="#使用-getter-与-setter-校验属性值">#</a> 使用 getter 与 setter 校验属性值</h3><p>校验传入的值是否是整型。如果不是，则抛出异常</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Ninja</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> _skillLevel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'skillLevel'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _skillLevel<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">"Skill level should be a number"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        _skillLevel <span class="token operator">=</span> value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">const</span> ninja <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ninja</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这段代码显示了如何规避指定属性发生类型错误异常。当然，这会增加性能开销，但是，在 JavaScript 这种动态类型语言中，为了安全需要付出性能开销</p><h3 id="使用-getter-与-setter-定义如何计算属性值"><a class="anchor" href="#使用-getter-与-setter-定义如何计算属性值">#</a> 使用 getter 与 setter 定义如何计算属性值</h3><p>除了能够控制指定对象属性的访问之外，getter 与 setter 还可以用于定义属性值的计算方法，即每次访问该属性时都会进行计算属性值。计算属性不会存储具体的值</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> shogun <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name<span class="token operator">:</span> <span class="token string">"Yoshiaki"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    clan<span class="token operator">:</span> <span class="token string">"Ashikaga"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">get</span> <span class="token function">fullTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>clan<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">set</span> <span class="token function">fullTitle</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token keyword">const</span> segments <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> segments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token keyword">this</span><span class="token punctuation">.</span>clan <span class="token operator">=</span> segments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="proxy"><a class="anchor" href="#proxy">#</a> Proxy</h2><p>代理（proxy）是我们通过代理控制对另一个对象的访问。</p><p>可以将代理理解为通用化的 setter 与 getter，区别是每个 setter 与 getter 仅能控制单个对象属性，而代理可用于对象交互的通用处理，包括调用对象的方法。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> emperor <span class="token operator">=</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Komei"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">const</span> representative <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>emperor<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">"Reading "</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">" through a proxy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token keyword">return</span> key <span class="token keyword">in</span> target <span class="token operator">?</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token operator">:</span> <span class="token string">"Don't bother the emperor!"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">"Writing "</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">" through a proxy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>我们首先创建基础对象 emperor，该对象仅含有 name 属性。然后，通过使用内置的 Proxy 构造函数，将对象 emperor（通常称为目标对象）包装为代理对象 representative。同时向代理构造函数传入第 2 个参数，第 2 个参数是一个对象，该对象内定义了在对象执行特定行为时触发的函数</p><p>若通过目标对象 emperor 直接访问 name 属性，则返回 Komei。但是，若通过代理对象访问，则隐式调用 get 方法。</p><p>需要强调的是，激活代理方法与 getter 和 setter 是一致的。一旦执行交互（如访问代理对象属性），就会隐式调用对应的 get 方法，此时 JavaScript 引擎的执行过程与显示调用的普通函数类似。</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220518081529686.png" alt="image-20220518081529686"></p><p>在本例中，我们使用 get 与 set，还有许多其他的内置方法用于定义各种对象的行为（详见 <span class="exturl" data-url="aHR0cDovL21uZy5iei9iYTU1JUVGJUJDJTg5JUUzJTgwJTgyJUU0JUJFJThCJUU1JUE2JTgyJUVGJUJDJTlB">http://mng.bz/ba55）。例如：</span></p><p>● 调用函数时激活 apply，使用 new 操作符时激活 construct。</p><p>● 读取 / 写入属性时激活 get 与 set。</p><p>● 执行 for-in 语句时激活 enumerate。</p><p>● 获取和设置属性值时激活 getPrototypeOf 与 setPropertyOf。</p><h3 id="使用代理记录日志"><a class="anchor" href="#使用代理记录日志">#</a> 使用代理记录日志</h3><p>对代理对象进行读写操作时，均会通过代理方法 report 输出记录日志</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">makeLoggable</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> property</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">"Reading "</span> <span class="token operator">+</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> target<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> property<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">"Writing value "</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">" to "</span> <span class="token operator">+</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        target<span class="token punctuation">[</span>property<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">let</span> ninja <span class="token operator">=</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Yoshi"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  ninja <span class="token operator">=</span> <span class="token function">makeLoggable</span><span class="token punctuation">(</span>ninja<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>  ninja<span class="token punctuation">.</span>weapon <span class="token operator">=</span> <span class="token string">"sword"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  ninja<span class="token punctuation">.</span>weapon</pre></td></tr></table></figure><h3 id="使用代理检测性能"><a class="anchor" href="#使用代理检测性能">#</a> 使用代理检测性能</h3><p>定义 apply 方法，当代理对象作为函数被调用时将会触发该 apply 方法的执行</p><p>每当调用 isPrime 函数时，都会进入代理的 apply 方法，开启内置的 console.time 方法秒表计时，调用原始的 isPrime 函数，记录运行时间，最后返回 isPrime 调用的结果。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">isPrime</span><span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> number<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">%</span> i <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  isPrime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>isPrime<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function-variable function">apply</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> thisArg<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">"isPrime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">target</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">"isPrime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token keyword">return</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token function">isPrime</span><span class="token punctuation">(</span><span class="token number">1299827</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="使用代理自动填充属性"><a class="anchor" href="#使用代理自动填充属性">#</a> 使用代理自动填充属性</h3><p>除了简化日志，代理还可用于自动填充属性。例如，假设需要抽象计算机的文件夹结构模型，一个文件夹对象既可以有属性，也可以是文件夹。现在假设你需要长路径的文件模型，如：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>rootFolder<span class="token punctuation">.</span>ninjasDir<span class="token punctuation">.</span>firstNinjaDir<span class="token punctuation">.</span>ninjaFile <span class="token operator">=</span> <span class="token string">"yoshi.txt"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>为了创建这个长路径文件模型，你可能会按照以下思路设计代码：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> rootFolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>rootFolder<span class="token punctuation">.</span>ninjasDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>rootFolder<span class="token punctuation">.</span>ninjasDir<span class="token punctuation">.</span>firstNinjaDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre>rootFolder<span class="token punctuation">.</span>ninjasDir<span class="token punctuation">.</span>firstNinjaDir<span class="token punctuation">.</span>ninjaFile <span class="token operator">=</span> <span class="token string">"yoshi.txt"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>似乎有点不必要的烦琐，不是吗？这时就需要自动填充属性登场</p><p>我们使用了代理，所以每次访问属性时，代理方法都被激活。如果访问的属性在文件夹对象存在，则直接返回对应的值；如果不存在，将会创建新的文件夹并赋值给该属性。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">Folder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> property</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">"Reading "</span> <span class="token operator">+</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>property <span class="token keyword">in</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>          target<span class="token punctuation">[</span>property<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> target<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">const</span> rootFolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    rootFolder<span class="token punctuation">.</span>ninjasDir<span class="token punctuation">.</span>firstNinjaDir<span class="token punctuation">.</span>ninjaFile <span class="token operator">=</span> <span class="token string">"yoshi.txt"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token function">pass</span><span class="token punctuation">(</span><span class="token string">"An exception wasn’t raised"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">"An exception has occurred"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="使用代理实现负数组索引"><a class="anchor" href="#使用代理实现负数组索引">#</a> 使用代理实现负数组索引</h3><p>首先，我们使用一元 + 操作符将属性名变成数值 (index = +index)。然后，如果索引值小于 0，则逆向访问数组；如果索引值大于 0 或等于 0，则使用标准的数组元素</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">createNegativeArrayProxy</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Expected an array'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        index <span class="token operator">=</span> <span class="token operator">+</span>index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> target<span class="token punctuation">[</span>index <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> target<span class="token punctuation">.</span>length <span class="token operator">+</span> index <span class="token operator">:</span> index<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> index<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        index <span class="token operator">=</span> <span class="token operator">+</span>index<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">return</span> target<span class="token punctuation">[</span>index <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> target<span class="token punctuation">.</span>length <span class="token operator">+</span> index <span class="token operator">:</span> index<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>代理最重要的缺点：性能问题。</strong></p><h2 id="小结-6"><a class="anchor" href="#小结-6">#</a> 小结</h2><blockquote><p>● 我们可以使用 getter、setter 和代理监控对象。</p><p>● 通过使用访问器方法（getter 和 setter），我们可以对对象属性的访问进行控制。</p><p>​	- 可以通过内置的 Object.defineProperty 方法定义访问属性，或在对象字面量中使用 get 和 set 语法或 ES6 的 class</p><p>​	- 当读取对象属性时会隐式调用 get 方法，当写入对象属性时隐式调用 set 方法。</p><p>​	- 使用 getter 方法可以定义计算属性，在每次读取对象属性时计算属性值；同理 setter 方法可用于实现数据验证与日志记录。</p><p>● 代理是 JavaScript ES6 中引入的，可用于控制对象。</p><p>​	- 代理可以定制对象交互时行为（例如，当读取属性或调用方法时）。</p><p>​	- 所有的交互行为都必须通过代理，指定的行为发生时会调用代理方法。</p><p>● 使用代理可以优雅地实现以下内容。</p><p>​	- 日志记录。</p><p>​	- 性能测量。</p><p>​	- 数据校验。</p><p>​	- 自动填充对象属性（以此避免讨厌的 null 异常）。</p><p>​	- 数组负索引。</p><p>● 代理效率不高，所以在需要执行多次的代码中需要谨慎使用。建议进行性能测试。</p></blockquote><h1 id="第九章-处理集合"><a class="anchor" href="#第九章-处理集合">#</a> 第九章 处理集合</h1><h2 id="数组"><a class="anchor" href="#数组">#</a> 数组</h2><h3 id="在数组两端添加-删除元素"><a class="anchor" href="#在数组两端添加-删除元素">#</a> 在数组两端添加、删除元素</h3><p>● push：在数组末尾添加元素。</p><p>● unshift: 在数组开头添加元素。</p><p>● pop: 从数组末尾删除元素。</p><p>● shift: 从数组开头删除元素</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220518211847201.png" alt="image-20220518211847201"></p><p>性能考虑：pop 和 push 与 shift 和 unshift</p><p>pop 和 push 方法只影响数组最后一个元素：pop 移除最后一个元素，push 在数组末尾增加元素。shift 和 unshift 方法修改第一个元素，之后的每一个元素的索引都需要调整。因此，pop 和 push 方法比 shift 和 unshift 要快很多，非特殊情况不建议使用 shift 和 unshift 法。</p><p>**splice 方法：**splice 具有两个参数：起始索引和需要移除的元素个数（这个参数如果不传，会一直删除元素直到数组末尾的元素）</p><p>splice 方法返回被移除的元素数组。在本例，返回的数组只有一个元素：Kuma。使用 splice 方法，也可以实现在数组任意位置插入元素。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>removedItems <span class="token operator">=</span> ninjas<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Mochizuki"</span><span class="token punctuation">,</span> <span class="token string">"Yoshi"</span><span class="token punctuation">,</span> <span class="token string">"Momochi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">//ninjas: ["Yagyu", "Mochizuki", "Yoshi", "Momochi"] </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">//removedItems: ["Hattori", "Fuma"]</span></pre></td></tr></table></figure><h3 id="数组常用操作"><a class="anchor" href="#数组常用操作">#</a> 数组常用操作</h3><p>● 遍历数组。foreach</p><p>● 基于现有的数组元素映射创建新数组。map</p><p>● 验证数组元素是否匹配指定的条件。every some</p><p>● 查找特定数组元素。find</p><p>● 聚合数组，基于数组元素计算（例如，计算数组元素之和）。reduce</p><p><strong>map</strong></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> weapons <span class="token operator">=</span> ninjas<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">ninja</span> <span class="token operator">=></span> ninja<span class="token punctuation">.</span>weapon<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>内置的 map 方法创建了一个全新的数组，然后遍历输入的数组。对输入数组的每个元素，在新建的数组上，都会基于回调函数的执行结果创建一个对应的元素。</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220518214137882.png" alt="image-20220518214137882"></p><p><strong>every</strong></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> allNinjasAreNamed <span class="token operator">=</span> ninjas<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">ninja</span> <span class="token operator">=></span> <span class="token string">"name"</span> <span class="token keyword">in</span> ninja<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>内置的 every 方法接收回调函数作为参数，会对每个元素执行该回调函数。如果所有数组元素的回调结果都返回 true 时，every 方法将返回 true，否则返回 false</p><p>内置的 some 方法接收回调函数作为参数。只要至少有一项元素的回调结果返回 true，some 方法就返回 true，否则返回 false</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220518214648736.png" alt="image-20220518214648736"></p><p><strong>some</strong></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> someNinjasAreArmed <span class="token operator">=</span> ninjas<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">ninja</span> <span class="token operator">=></span> <span class="token string">"weapon"</span> <span class="token keyword">in</span> ninja<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220518221026352.png" alt="image-20220518221026352"></p><p><strong>find</strong></p><p>使用内置的 find 方法，传入回调函数，针对集合中的每个元素调用回调函数，直到查找到目标元素。由回调函数返回 true。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>ninjaWithKatana <span class="token operator">=</span> ninjas<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">ninja</span> <span class="token operator">=></span> ninja<span class="token punctuation">.</span>weapon <span class="token operator">===</span> <span class="token string">"katana"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>如果数组中没有一项返回 true 的元素，则查找的结果是 undefined。</p><p><strong>filter</strong></p><p>如果需要查找满足条件的多个元素，可以使用 filter 方法，该方法返回满足条件的多个元素的数组。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> armedNinjas <span class="token operator">=</span> ninjas<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">ninja</span> <span class="token operator">=></span> <span class="token string">"weapon"</span> <span class="token keyword">in</span> ninja<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220518222605637.png" alt="image-20220518222605637"></p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220518222617599.png" alt="image-20220518222617599"></p><p><strong>indexOf lastIndexOf findIndex</strong></p><p>使用内置的 indexOf 方法查找特定元素的索引，传入目标元素作为参数：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>ninjas<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"Yoshi"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>有时在数组中具有多个指定的元素（如 Yoshi），查找最后一次 Yoshi 出现的索引，可以使用 lastIndexOf 方法：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>ninjas<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"Yoshi"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>最后，在大多数情况下，当不具有目标元素的引用时，可以使用 findIndex 方法查找索引：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> yoshiIndex <span class="token operator">=</span> ninjas<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">ninja</span> <span class="token operator">=></span> ninja <span class="token operator">===</span> <span class="token string">"Yoshi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>findIndex 方法接收回调函数，并返回第一个回调函数返回 true 的元素。本质上 findIndex 与 find 方法类似，唯一的区别是 find 方法返回元素本身，而 findIndex 方法返回元素的索引。</p><p><strong>reduce</strong></p><p>代码遍历集合中的所有元素进行求和。JavaScript 引擎也帮助我们解决此类问题：reduce 方法</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> sum <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">aggregated<span class="token punctuation">,</span> number</span><span class="token punctuation">)</span> <span class="token operator">=></span> aggregated <span class="token operator">+</span> number<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>reduce 方法接收初始值，对数组每个元素执行回调函数，回调函数接收上一次回调结果以及当前的数组元素作为参数。最后一次回调函数的结果作为 reduce 的结果。</p><p><img data-src="js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D.assets/image-20220518223121816.png" alt="image-20220518223121816"></p><p>复用 JavaScript 数组的方法：Array.prototype.push，而不是自己编写代码。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> elem<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="map"><a class="anchor" href="#map">#</a> Map</h2><p>这种集合，将 key 映射到指定的值上，在不同的编程语言中具有不同的名称，通常称为字典或 Map。</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> ninjaIslandMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">const</span> ninja1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Yoshi"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">const</span> ninja2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Hattori"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">const</span> ninja3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Kuma"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  ninjaIslandMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> homeIsland<span class="token operator">:</span> <span class="token string">"Honshu"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  ninjaIslandMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>ninja2<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> homeIsland<span class="token operator">:</span> <span class="token string">"Hokkaido"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token function">assert</span><span class="token punctuation">(</span>ninjaIslandMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">)</span><span class="token punctuation">.</span>homeIsland <span class="token operator">===</span> <span class="token string">"Honshu"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token string">"The first mapping works"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">assert</span><span class="token punctuation">(</span>ninjaIslandMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ninja2<span class="token punctuation">)</span><span class="token punctuation">.</span>homeIsland <span class="token operator">===</span> <span class="token string">"Hokkaido"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token string">"The second mapping works"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token function">assert</span><span class="token punctuation">(</span>ninjaIslandMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ninja3<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token string">"There is no mapping for the third ninja!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">assert</span><span class="token punctuation">(</span>ninjaIslandMap<span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token string">"We've created two mappings"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token function">assert</span><span class="token punctuation">(</span>ninjaIslandMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token operator">&amp;&amp;</span> ninjaIslandMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>ninja2<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token string">"We have mappings for the first two ninjas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token operator">!</span>ninjaIslandMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>ninja3<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token string">"But not for the third ninja!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>  ninjaIslandMap<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token operator">!</span>ninjaIslandMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token operator">&amp;&amp;</span> ninjaIslandMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token string">"There's no first ninja mapping anymore!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>  ninjaIslandMap<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token function">assert</span><span class="token punctuation">(</span>ninjaIslandMap<span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token string">"All mappings have been cleared"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在本例中，我们调用 Map 构造函数创建 map：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> ninjaIslandMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>然后，创建 3 个 ninja 对象，分别命名为 ninja1、ninja2、ninja3。使用 set 方法：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>ninjaIslandMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> homeIsland<span class="token operator">:</span> <span class="token string">"Honshu"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>通过 get 方法获取前两个 ninja 对象的映射：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">assert</span><span class="token punctuation">(</span>ninjaIslandMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">)</span><span class="token punctuation">.</span>homeIsland <span class="token operator">===</span> <span class="token string">"Honshu"</span><span class="token punctuation">,</span>  <span class="token string">"The first mapping works"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>除了 get 和 set 方法之外，map 还具有 size 属性以及 has、delete 方法。size 属性告诉我们已经创建了多少个映射。在本例，我们创建了两个映射。</p><p>has 方法用于判断指定的 key 是否存在：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>ninjaIslandMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true </span></pre></td></tr><tr><td data-num="2"></td><td><pre>ninjaIslandMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>ninja3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span></pre></td></tr></table></figure><p>delete 方法可用于删除映射：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>ninjaIslandMap<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>ninja1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>map 是键值对的集合，key 可以是任意类型的值，甚至可以是对象</p><div class="tags"><a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag"><i class="ic i-tag"></i> 读书笔记</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-05-19 17:43:00" itemprop="dateModified" datetime="2022-05-19T17:43:00+08:00">2022-05-19</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="sparkle 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="sparkle 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="sparkle 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>sparkle <i class="ic i-at"><em>@</em></i>Sparkle</li><li class="link"><strong>本文链接：</strong> <a href="https://1234cas.github.io/1234cas.github.io/Reading-minutes/js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D/" title="js忍者秘籍">https://1234cas.github.io/1234cas.github.io/Reading-minutes/js忍者秘籍/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/Reading-minutes/%E8%AF%BB%E4%B9%A6%E5%88%97%E8%A1%A8/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipew8gmvyj20zk0m87wh.jpg" title="读书列表"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 读书笔记</span><h3>读书列表</h3></a></div><div class="item right"><a href="/Reading-minutes/%E5%85%B3%E4%BA%8E%E8%AF%BB%E4%B9%A6/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclwuom7cj20zk0m8dvn.jpg" title="关于读书"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 读书笔记</span><h3>关于读书</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0"><span class="toc-number">1.</span> <span class="toc-text">第一章</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89"><span class="toc-number">2.</span> <span class="toc-text">第三章 函数定义</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89"><span class="toc-number">2.2.</span> <span class="toc-text">函数定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">2.3.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">第四章 函数调用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text">函数调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-2"><span class="toc-number">3.2.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E9%97%AD%E5%8C%85%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">4.</span> <span class="toc-text">第五章 闭包和作用域</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AD%E5%8C%85"><span class="toc-number">4.1.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">4.2.</span> <span class="toc-text">执行上下文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%8D%E6%B3%95%E7%8E%AF%E5%A2%83"><span class="toc-number">4.3.</span> <span class="toc-text">词法环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.4.</span> <span class="toc-text">变量类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AD%E5%8C%85%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">4.5.</span> <span class="toc-text">闭包工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-3"><span class="toc-number">4.6.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-%E7%94%9F%E6%88%90%E5%99%A8%E5%92%8Cpromise"><span class="toc-number">5.</span> <span class="toc-text">第六章 生成器和 promise</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">5.1.</span> <span class="toc-text">生成器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8%E4%BA%A4%E4%BA%92"><span class="toc-number">5.1.1.</span> <span class="toc-text">与生成器交互</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E5%86%85%E9%83%A8%E6%9E%84%E9%80%A0"><span class="toc-number">5.1.2.</span> <span class="toc-text">生成器内部构造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E8%B7%9F%E8%B8%AA%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0"><span class="toc-number">5.1.3.</span> <span class="toc-text">通过执行上下文跟踪生成器函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#promise"><span class="toc-number">5.2.</span> <span class="toc-text">Promise</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">5.2.1.</span> <span class="toc-text">简单回调函数的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%A0%94%E7%A9%B6promise"><span class="toc-number">5.2.2.</span> <span class="toc-text">深入研究 Promise</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%92%E7%BB%9Dpromise"><span class="toc-number">5.2.3.</span> <span class="toc-text">拒绝 Promise</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#promise%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.4.</span> <span class="toc-text">Promise 案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E5%92%8Cpromise%E7%BB%93%E5%90%88"><span class="toc-number">5.3.</span> <span class="toc-text">生成器和 Promise 结合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-4"><span class="toc-number">5.4.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%8E%9F%E5%9E%8B"><span class="toc-number">6.</span> <span class="toc-text">第七章 面向对象和原型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B"><span class="toc-number">6.1.</span> <span class="toc-text">原型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-5"><span class="toc-number">6.2.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0-%E6%8E%A7%E5%88%B6%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE"><span class="toc-number">7.</span> <span class="toc-text">第八章 控制对象的访问</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#getter-%E5%92%8C-setter"><span class="toc-number">7.1.</span> <span class="toc-text">getter 和 setter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-getter-%E4%B8%8E-setter-%E6%A0%A1%E9%AA%8C%E5%B1%9E%E6%80%A7%E5%80%BC"><span class="toc-number">7.1.1.</span> <span class="toc-text">使用 getter 与 setter 校验属性值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-getter-%E4%B8%8E-setter-%E5%AE%9A%E4%B9%89%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E5%80%BC"><span class="toc-number">7.1.2.</span> <span class="toc-text">使用 getter 与 setter 定义如何计算属性值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#proxy"><span class="toc-number">7.2.</span> <span class="toc-text">Proxy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97"><span class="toc-number">7.2.1.</span> <span class="toc-text">使用代理记录日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%E6%A3%80%E6%B5%8B%E6%80%A7%E8%83%BD"><span class="toc-number">7.2.2.</span> <span class="toc-text">使用代理检测性能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85%E5%B1%9E%E6%80%A7"><span class="toc-number">7.2.3.</span> <span class="toc-text">使用代理自动填充属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0%E8%B4%9F%E6%95%B0%E7%BB%84%E7%B4%A2%E5%BC%95"><span class="toc-number">7.2.4.</span> <span class="toc-text">使用代理实现负数组索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-6"><span class="toc-number">7.3.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0-%E5%A4%84%E7%90%86%E9%9B%86%E5%90%88"><span class="toc-number">8.</span> <span class="toc-text">第九章 处理集合</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">8.1.</span> <span class="toc-text">数组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%95%B0%E7%BB%84%E4%B8%A4%E7%AB%AF%E6%B7%BB%E5%8A%A0-%E5%88%A0%E9%99%A4%E5%85%83%E7%B4%A0"><span class="toc-number">8.1.1.</span> <span class="toc-text">在数组两端添加、删除元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">8.1.2.</span> <span class="toc-text">数组常用操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#map"><span class="toc-number">8.2.</span> <span class="toc-text">Map</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/Reading-minutes/%E5%85%B3%E4%BA%8E%E7%AC%94%E8%AE%B0/" rel="bookmark" title="关于笔记">关于笔记</a></li><li><a href="/Reading-minutes/%E5%85%B3%E4%BA%8E%E8%AF%BB%E4%B9%A6/" rel="bookmark" title="关于读书">关于读书</a></li><li class="active"><a href="/Reading-minutes/js%E5%BF%8D%E8%80%85%E7%A7%98%E7%B1%8D/" rel="bookmark" title="js忍者秘籍">js忍者秘籍</a></li><li><a href="/Reading-minutes/%E8%AF%BB%E4%B9%A6%E5%88%97%E8%A1%A8/" rel="bookmark" title="读书列表">读书列表</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="sparkle" data-src="/images/avatar.jpg"><p class="name" itemprop="name">sparkle</p><div class="description" itemprop="description">好好读书</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">35</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">13</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">11</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span> <span class="exturl item google" data-url="aHR0cHM6Ly9wbHVzLmdvb2dsZS5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;plus.google.com&#x2F;yourname"><i class="ic i-google"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnlvdXJuYW1lQG1haWwuY29t" title="mailto:yourname@mail.com"><i class="ic i-envelope"></i></span> <span class="exturl item facebook" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;www.facebook.com&#x2F;yourname"><i class="ic i-facebook"></i></span> <span class="exturl item stackoverflow" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;stackoverflow.com&#x2F;yourname"><i class="ic i-stack-overflow"></i></span> <span class="exturl item youtube" data-url="aHR0cHM6Ly95b3V0dWJlLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;youtube.com&#x2F;yourname"><i class="ic i-youtube"></i></span> <span class="exturl item instagram" data-url="aHR0cHM6Ly9pbnN0YWdyYW0uY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;instagram.com&#x2F;yourname"><i class="ic i-instagram"></i></span> <span class="exturl item skype" data-url="c2t5cGU6eW91cm5hbWU/Y2FsbHxjaGF0" title="skype:yourname?call|chat"><i class="ic i-skype"></i></span> <span class="exturl item douban" data-url="aHR0cHM6Ly93d3cuZG91YmFuLmNvbS9wZW9wbGUveW91cm5hbWUv" title="https:&#x2F;&#x2F;www.douban.com&#x2F;people&#x2F;yourname&#x2F;"><i class="ic i-douban"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>链接</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/Reading-minutes/%E8%AF%BB%E4%B9%A6%E5%88%97%E8%A1%A8/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/Reading-minutes/%E5%85%B3%E4%BA%8E%E8%AF%BB%E4%B9%A6/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" title="分类于 编程笔记">编程笔记</a></div><span><a href="/Coding-diary/2022-4-1/" title="2022-4-1">2022-4-1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%BC%96%E7%A8%8B/" title="分类于 编程">编程</a></div><span><a href="/Programme/%E7%BC%96%E7%A8%8B/" title="编程">编程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Front-end/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/Front-end/ES6/" title="分类于 ES6">ES6</a></div><span><a href="/Front-end/ES6/ES6%E4%B8%8A/" title="ES6上">ES6上</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Front-end/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/Front-end/%E4%B8%80%E6%96%B9%E9%9D%A2/" title="分类于 一方面">一方面</a></div><span><a href="/Front-end/One-side/SVG/" title="SVG">SVG</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/Algorithms/%E7%AE%97%E6%B3%95%E7%AC%AC%E5%9B%9B%E7%89%88%E4%B8%8B/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hexo/" title="分类于 Hexo">Hexo</a></div><span><a href="/Hexo/Hexo/" title="Hexo">Hexo</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%85%B6%E4%BB%96/" title="分类于 其他">其他</a></div><span><a href="/Other/%E4%BA%8C%E6%AC%A1%E5%85%83%E7%BD%91%E7%AB%99/" title="二次元网站">二次元网站</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%97%A5%E8%AE%B0/" title="分类于 日记">日记</a></div><span><a href="/Diary/2022-4-14/" title="2022-4-14">2022-4-14</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Front-end/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/Front-end/%E6%A8%A1%E4%BB%BF%E7%AC%94%E8%AE%B0/" title="分类于 模仿笔记">模仿笔记</a></div><span><a href="/Front-end/Imitation-notes/codingstartup/" title="codingstartup">codingstartup</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Reading-minutes/" title="分类于 读书笔记">读书笔记</a></div><span><a href="/Reading-minutes/%E5%85%B3%E4%BA%8E%E8%AF%BB%E4%B9%A6/" title="关于读书">关于读书</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">sparkle @ Sparkle</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">681k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">10:20</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"Reading-minutes/js忍者秘籍/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:{placeholder:"1. 提问前请先仔细阅读本文档⚡\n2. 页面显示问题💥，请提供控制台截图📸或者您的测试网址\n3. 其他任何报错💣，请提供详细描述和截图📸，祝食用愉快💪"},fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->