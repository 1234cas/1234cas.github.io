<!-- build time:Tue Oct 31 2023 21:50:08 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Sparkle" href="https://1234cas.github.io/1234cas.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Sparkle" href="https://1234cas.github.io/1234cas.github.io/atom.xml"><link rel="alternate" type="application/json" title="Sparkle" href="https://1234cas.github.io/1234cas.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="前端,Vue"><link rel="canonical" href="https://1234cas.github.io/1234cas.github.io/Front-end/Vue/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E7%AC%94%E8%AE%B0/"><title>黑马头条笔记 - Vue - 前端 | Sparkle = Sparkle = 加油</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">黑马头条笔记</h1><div class="meta"><span class="item" title="创建时间：2023-05-15 10:40:05"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-05-15T10:40:05+08:00">2023-05-15</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>23k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>21 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Sparkle</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclgrvbd6j20zk0m8qv5.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicis081o9j20zk0m8dmr.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipetlbztpj20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicitspjpbj20zk0m81ky.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclffsa1cj20zk0m811l.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipey84bjtj20zk0m8hdt.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Front-end/" itemprop="item" rel="index" title="分类于 前端"><span itemprop="name">前端</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Front-end/Vue/" itemprop="item" rel="index" title="分类于 Vue"><span itemprop="name">Vue</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://1234cas.github.io/1234cas.github.io/Front-end/Vue/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E7%AC%94%E8%AE%B0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="sparkle"><meta itemprop="description" content="加油, 好好读书"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sparkle"></span><div class="body md" itemprop="articleBody"><h4 id="1安装和配置axios"><a class="anchor" href="#1安装和配置axios">#</a> 1. 安装和配置 axios</h4><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 调用 axios.create () 方法，创建 axios 的实例对象</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token comment">// 请求根路径</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	baseURL<span class="token operator">:</span> <span class="token string">'http://www.liulongbin.top:8000'</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> instance</pre></td></tr></table></figure><h4 id="2覆盖默认样式"><a class="anchor" href="#2覆盖默认样式">#</a> 2. 覆盖默认样式</h4><h4 id="3登录功能"><a class="anchor" href="#3登录功能">#</a> 3. 登录功能</h4><ol><li><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>声明数据</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	name<span class="token operator">:</span> <span class="token string">'Login'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token keyword">return</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>			<span class="token comment">// 登录表单的数据，最终要双向绑定到 form 这个数据对象上</span></pre></td></tr><tr><td data-num="7"></td><td><pre>			form<span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>				mobile<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>				code<span class="token operator">:</span><span class="token string">''</span></pre></td></tr><tr><td data-num="10"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录的表单 <span class="token operator">--</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token operator">&lt;</span>van<span class="token operator">-</span>form<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token operator">&lt;</span>van<span class="token operator">-</span>field v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"form.mobile"</span> type<span class="token operator">=</span><span class="token string">"tel"</span> label<span class="token operator">=</span><span class="token string">"手机号码"</span> placeholder<span class="token operator">=</span><span class="token string">"请输入手机号码"</span> required<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>van<span class="token operator">-</span>field<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token operator">&lt;</span>van<span class="token operator">-</span>field v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"form.code"</span> type<span class="token operator">=</span><span class="token string">"password"</span> label<span class="token operator">=</span><span class="token string">"登录密码"</span> placeholder<span class="token operator">=</span><span class="token string">"请输入登录密码"</span> required<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>van<span class="token operator">-</span>field<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token string">"margin: 16px;"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre>     <span class="token operator">&lt;</span>van<span class="token operator">-</span>button round block type<span class="token operator">=</span><span class="token string">"info"</span> native<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>van<span class="token operator">-</span>button<span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre>   <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token operator">&lt;</span><span class="token operator">/</span>van<span class="token operator">-</span>form<span class="token operator">></span></pre></td></tr></table></figure></li><li><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>添加非空校验规则</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	name<span class="token operator">:</span> <span class="token string">'Login'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	data<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token keyword">return</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>			<span class="token comment">// 表单的校验规则对象</span></pre></td></tr><tr><td data-num="7"></td><td><pre>			rules<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>				mobile<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'请输入'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'onBlur'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>				code<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'请输入'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'onBlur'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="10"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>在 Login<span class="token punctuation">.</span>vue 组件的模板结构中，为每个 <span class="token operator">&lt;</span>van<span class="token operator">-</span>field<span class="token operator">></span> 组件应用对应的校验规则：</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 手机号的表单项 <span class="token operator">--</span><span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">&lt;</span>van<span class="token operator">-</span>field type<span class="token operator">=</span><span class="token string">"tel"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"form.mobile"</span> label<span class="token operator">=</span><span class="token string">"手机号码"</span> placeholder<span class="token operator">=</span><span class="token string">"请输入手机号码"</span> required <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">"rules.mobile"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>van<span class="token operator">-</span>field<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 登录密码的表单项 <span class="token operator">--</span><span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">&lt;</span>van<span class="token operator">-</span>field type<span class="token operator">=</span><span class="token string">"password"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"form.code"</span> label<span class="token operator">=</span><span class="token string">"登录密码"</span> placeholder<span class="token operator">=</span><span class="token string">"请输入登录密码"</span> required <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">"rules.code"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>van<span class="token operator">-</span>field<span class="token operator">></span></pre></td></tr></table></figure></li><li><pre><code>  通过pattern进行正则校验
 mobile:[
 	&#123; required: true, message: '1', trigger: 'onBlur' &#125;,
 	&#123; pattern: /^1\d&#123;10&#125;$/, message: '2', trigger: 'onBlur' &#125;
 ]
</code></pre></li><li><pre><code>  监听表单的提交事件
  &lt;van-form @submit='login'&gt;&lt;/van-form&gt;
  
  methods:&#123;
  	login() &#123;
  		console.log(1)
  	&#125;
  &#125;
</code></pre></li><li><pre><code>  封装登录的 API 接口
  import request from '@/utils/request'
  
  export const loginAPI = data =&gt; &#123;
  	return request.post('/v1_0/authorizations', data)
  &#125;
</code></pre></li><li><pre><code>  调用登录的 API 接口
  import loginAPI from '@/api/userAPI'
  
  methods:&#123;
  	async login() &#123;
  		const res = await loginAPI(this.form)
  		console.log(res)
  	&#125;
  &#125;
</code></pre></li><li><pre><code>   使用解构赋值
   methods: &#123;
   	async login() &#123;
   		const &#123; data: res &#125; = await loginAPI(this.form)
   		console.log(res)
   		
   		if (res.message === 'OK') &#123;
   			//
   		&#125;
   	&#125;
   &#125;
</code></pre></li></ol><h4 id="4token的存储"><a class="anchor" href="#4token的存储">#</a> 4.token 的存储</h4><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	state<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>		tokenInfo<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	mutations<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		<span class="token comment">// 更新 tokenInfo 数据的方法</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token function">updataTokenInfo</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token comment">// 把提交过来的 payload 对象，作为 tokenInfo 的值</span></pre></td></tr><tr><td data-num="9"></td><td><pre>			state<span class="token punctuation">.</span>tokenInfo <span class="token operator">=</span> payload</pre></td></tr><tr><td data-num="10"></td><td><pre>			</pre></td></tr><tr><td data-num="11"></td><td><pre>			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">// 1. 按需导入辅助方法</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> mapMutations <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	methods<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>         <span class="token comment">// 2. 映射 mutations 中的方法</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		<span class="token operator">...</span><span class="token function">mapMutation</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'updateTokenInfo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>		</pre></td></tr><tr><td data-num="24"></td><td><pre>		<span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>			<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token operator">:</span> res <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loginAPI</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>			</pre></td></tr><tr><td data-num="27"></td><td><pre>			<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">'OK'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                <span class="token comment">// 3. 把登录成功的结果，存储到 vuex 中</span></pre></td></tr><tr><td data-num="29"></td><td><pre>				<span class="token keyword">this</span><span class="token punctuation">.</span>updateTokenInfo <span class="token operator">=</span> res<span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token comment">// 4. 登录成功后，跳转到主页</span></pre></td></tr><tr><td data-num="31"></td><td><pre>				<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="5持久化存储state"><a class="anchor" href="#5持久化存储state">#</a> 5. 持久化存储 state</h4><blockquote><p>存储在 vuex 中的数据都是<strong>内存数据</strong>，只要浏览器一刷新，vuex 的数据就被清空了。</p><p>为了防止这个问题，我们可以把 vuex 中的数据持久化存储到浏览器的 <strong>localStorage</strong> 中。</p></blockquote><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 将 state 持久化存储到本地</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">saveStateToStorage</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringfy</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">updateTokenInfo</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	state<span class="token punctuation">.</span>tokenInfo <span class="token operator">=</span> payload</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token comment">// 如果希望在 Mutation A 中调用 Mutation B，需要通过 this.commit () 方法来实现</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  	<span class="token comment">//this 表示当前传入的 store 实例对象</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'saveStateToStorage'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>初始化 vuex 时加载本地的 state</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">let</span> initSate <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    tokenInfo<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">const</span> stateStr <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>stateStr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// 加载本地的数据</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    initState <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>stateStr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// 为 state 赋初值</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    state<span class="token operator">:</span> initState</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="6axios拦截器"><a class="anchor" href="#6axios拦截器">#</a> 6.axios 拦截器</h4><p>经典使用场景就是 loading 页面 请求数据和返回数据都会触发拦截器</p><ol><li><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 定义请求拦截器的固定写法：</span></pre></td></tr><tr><td data-num="2"></td><td><pre>axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token keyword">return</span> config</pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure></li><li><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 定义响应拦截器的固定写法：</span></pre></td></tr><tr><td data-num="2"></td><td><pre>axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token keyword">return</span> response</pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure></li><li><blockquote><p><strong>基于 Vant 的</strong> <span class="exturl" data-url="aHR0cHM6Ly92YW50LWNvbnRyaWIuZ2l0ZWUuaW8vdmFudC8jL3poLUNOL3RvYXN0">Toast 轻提示</span> <strong>组件，可以方便的展示 loading 效果</strong></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Toast <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vant'</span></pre></td></tr></table></figure></blockquote><pre><code>// 请求拦截器
// 注意：在我们的项目中，是基于 instance 实例来发起 ajax 请求的，因此一定要为 instance 实例绑定请求拦截器
instance.interceptors.request.use(
	config =&gt; &#123;
		Toast.loading(&#123;
			message: 'loading...',
			duration: 0 // 展示时长(ms)，值为 0 时，toast 不会消失
		&#125;)
		return config
	&#125;,
	error =&gt; &#123;
		return Promis.reject(error)
	&#125;
)
</code></pre></li><li><pre><code>// 响应拦截器（注意：响应拦截器也应该绑定给 instance 实例）
instance.interceptors.response.use(
	config =&gt; &#123;
		Toast.clear()
		return response
	&#125;,
	error =&gt; &#123;
		return Promise.reject(error)
	&#125;
)
</code></pre></li><li><p>基于拦截器添加 token 认证</p></li></ol><blockquote><p>在 <code>request.js</code> 模块中导入 vuex 的模块：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store/index'</span></pre></td></tr></table></figure></blockquote><pre><code>instance.interceptors.request.use(
	config =&gt; &#123;
		// 1. 获取 token 值
		const tokenStr = store.state.tokenInfo.token
		// 2. 判断 tokenStr 的值是否为空
		if (tokenStr) &#123;
			//3. 如果 tokenStr 的值不为空， 则为这次请求的请求头添加 Authorization 身份认证字段：
			config.headers.Authorization = 'Bearer $&#123;tokenStr&#125;'
		&#125;
		return config
	&#125;,
	function(error) &#123;
		return Promise.reject(error)
	&#125;
)
</code></pre><p>tips：Vue 官方建议在绑定 props 时，把 “小驼峰” 的属性名，改造成 “短横线” 的形式使用</p><h4 id="7初步封装-artlist-组件"><a class="anchor" href="#7初步封装-artlist-组件">#</a> 7. 初步封装 ArtList 组件</h4><ol><li><pre><code>&lt;template&gt;
  &lt;div&gt;文章列表组件&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default &#123;
  name: 'ArtList'
&#125;
&lt;/script&gt;

&lt;style lang=&quot;less&quot; scoped&gt;&lt;/style&gt;
</code></pre></li><li><pre><code>import ArtList from '@/components/ArtList/ArtList.vue'
</code></pre></li><li><pre><code>components: &#123;
  ArtList
&#125;
&lt;template&gt;

&lt;!-- 频道列表的标签页 --&gt;
&lt;van-tabs v-model=&quot;active&quot; sticky offset-top=&quot;1.22666667rem&quot;&gt;
  &lt;!-- 循环渲染用户的频道 --&gt;
  &lt;van-tab v-for=&quot;item in userChannel&quot; :key=&quot;item.id&quot; :title=&quot;item.name&quot;&gt;
    &lt;!-- 在每一个用户频道下，渲染出对应的“文章列表组件” --&gt;
    &lt;art-list&gt;&lt;/art-list&gt;
  &lt;/van-tab&gt;
&lt;/van-tabs&gt;
</code></pre></li></ol><p>封装 channelId 属性 父向子传值 props</p><ol><li><pre><code>export default &#123;
  name: 'ArtList',
  props: &#123;
    // 频道 Id（小驼峰命名法：第一个单词全部小写，后面的单词首字母大写）
    channelId: &#123;
      type: Number, // 数值类型
      required: true // 必填项
    &#125;
  &#125;
&#125;
</code></pre></li><li><pre><code>&lt;van-tabs v-model=&quot;active&quot; sticky offset-top=&quot;1.22666667rem&quot;&gt;
  &lt;van-tab v-for=&quot;item in userChannel&quot; :key=&quot;item.id&quot; :title=&quot;item.name&quot;&gt;
    &lt;!-- 注意：Vue 官方建议在绑定 props 时，把“小驼峰”的属性名，改造成“短横线”的形式使用 --&gt;
    &lt;art-list :channel-id=&quot;item.id&quot;&gt;&lt;/art-list&gt;
  &lt;/van-tab&gt;
&lt;/van-tabs&gt;
</code></pre></li><li><pre><code>&lt;template&gt;
  &lt;div&gt;文章列表组件 --- &#123;&#123;channelId&#125;&#125;&lt;/div&gt;
&lt;/template&gt;
</code></pre></li></ol><h4 id="8上拉加载"><a class="anchor" href="#8上拉加载">#</a> 8. 上拉加载</h4><ol><li><pre><code>声明数据
data() &#123;
	return &#123;
		loading: false,
		finished: false
	&#125;
&#125;
</code></pre></li><li><pre><code>在 ArtList.vue 组件的模板结构中，使用 &lt;van-list&gt; 组件将 &lt;art-item&gt; 组件包裹起来：
&lt;template&gt;
  &lt;div&gt;
    &lt;van-list v-model=&quot;loading&quot; :finished=&quot;finished&quot; finished-text=&quot;没有更多了&quot; @load=&quot;onLoad&quot;&gt;
      &lt;!-- 循环渲染文章的列表 --&gt;
      &lt;art-item v-for=&quot;item in artlist&quot; :key=&quot;item.art_id&quot; :article=&quot;item&quot;&gt;&lt;/art-item&gt;
    &lt;/van-list&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre></li><li><pre><code>methods: &#123;
  // 加载更多的数据
  onLoad() &#123;
    console.log('触发了上拉加载更多')
  &#125;
&#125;
</code></pre></li></ol><p>tips: 经过翻阅 Vant 的官方文档，发现可以为 <code>&lt;van-list&gt;</code> 组件绑定 <code>:immediate-check=&quot;false&quot;</code> 属性，即可防止首次加载时触发 load 事件：</p><ol start="4"><li><pre><code>// 调用 initArtList 方法
onLoad() &#123;
  console.log('触发了上拉加载更多')
  this.initArtList()
&#125;
</code></pre></li><li><pre><code>// 初始化文章的列表数据
async initArtList() &#123;
  // 请求 API 接口
  const &#123; data: res &#125; = await getArtListAPI(this.channelId)
  if (res.message === 'OK') &#123;
    // 为时间戳重新赋值
    this.timestamp = res.data.pre_timestamp
    // 1. 上拉加载更多时，应该是“旧数据”在前，“新数据”在后
    this.artlist = [...this.artlist, ...res.data.results]
    // 2. 重置 loading 为 false
    this.loading = false
    // 3. 判断所有的数据是否已加载完毕
    if (res.data.pre_timestamp === null) &#123;
      this.finished = true
    &#125;
  &#125;
&#125;,
</code></pre></li></ol><h4 id="9下拉刷新"><a class="anchor" href="#9下拉刷新">#</a> 9. 下拉刷新</h4><ol><li><pre><code>data() &#123;
  return &#123;
    // 是否正在进行下拉刷新的请求
    isLoading: false
  &#125;
&#125;
</code></pre></li><li><pre><code>在 &lt;van-list&gt; 之外包裹实现下拉刷新的 &lt;van-pull-refresh&gt; 组件：
&lt;template&gt;
  &lt;div&gt;
    &lt;!-- 下拉刷新 --&gt;
    &lt;van-pull-refresh v-model=&quot;isLoading&quot; @refresh=&quot;onRefresh&quot;&gt;
      &lt;!-- 上拉加载更多 --&gt;
      &lt;van-list v-model=&quot;loading&quot; :finished=&quot;finished&quot; finished-text=&quot;没有更多了&quot; @load=&quot;onLoad&quot; :immediate-check=&quot;false&quot;&gt;
        &lt;!-- 循环渲染文章的列表 --&gt;
        &lt;art-item v-for=&quot;item in artlist&quot; :key=&quot;item.art_id&quot; :article=&quot;item&quot;&gt;&lt;/art-item&gt;
      &lt;/van-list&gt;
    &lt;/van-pull-refresh&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre></li><li><pre><code>methods: &#123;
  // 下拉刷新
  onRefresh() &#123;
    console.log('触发了下拉刷新')
    this.initArtList(true)
  &#125;
&#125;
</code></pre></li><li><pre><code>改造 methods 中的 initArtList 函数，通过形参接收调用者传递过来的值：
methods: &#123;
  // 初始化文章的列表数据
  // 如果 isRefresh 的值为 true，证明是下拉刷新，在最终拼接数据时，应该是“新数据”在前，“旧数据”在后
  // 如果 isRefresh 的值不为 true，证明不是下拉刷新，则拼接数据时，应该是“旧数据”在前，“新数据”在后
  async initArtList(isRefresh) &#123;
    // 省略其它代码...
  &#125;
&#125;
</code></pre></li><li><pre><code>// 初始化文章的列表数据
async initArtList(isRefresh) &#123;
  // 请求 API 接口
  const &#123; data: res &#125; = await getArtListAPI(this.channelId)
  if (res.message === 'OK') &#123;
    // 为时间戳重新赋值
    this.timestamp = res.data.pre_timestamp
    // 判断是否为下拉刷新
    if (isRefresh) &#123;
      // 下拉刷新
      // 1. “新数据”在前，“旧数据”在后
      this.artlist = [...res.data.results, ...this.artlist]
      // 2. 重置 isLoading 为 false
      this.isLoading = false
    &#125; else &#123;
      // 上拉加载
      // 1. “旧数据”在前，“新数据”在后
      this.artlist = [...this.artlist, ...res.data.results]
      // 2. 重置 loading 为 false
   this.loading = false
    &#125;

    // 3. 判断所有的数据是否已加载完毕
    if (res.data.pre_timestamp === null) &#123;
      this.finished = true
    &#125;
  &#125;
&#125;
</code></pre></li><li><pre><code>没有更多数据时，禁用下拉刷新的效果：
&lt;van-pull-refresh v-model=&quot;isLoading&quot; @refresh=&quot;onRefresh&quot; :disabled=&quot;finished&quot;&gt;&lt;/van-pull-refresh&gt;
</code></pre></li></ol><h4 id="10dayjs"><a class="anchor" href="#10dayjs">#</a> 10.day.js</h4><ol><li><pre><code>npm install dayjs --save
</code></pre></li><li><pre><code>// 导入 dayjs 的核心模块
import dayjs from 'dayjs'
// 导入计算相对时间的插件
import relativeTime from 'dayjs/plugin/relativeTime'
// 导入中文语言包
import zh from 'dayjs/locale/zh-cn'
</code></pre></li><li><pre><code>// 配置“计算相对时间”的插件
dayjs.extend(relativeTime)
// 配置中文语言包
dayjs.locale(zh)
</code></pre></li><li><pre><code>// dt 参数是文章的发表时间
Vue.filter('dateFormat', dt =&gt; &#123;
  // 调用 dayjs() 得到的是当前的时间
  // .to() 方法的返回值，是计算出来的“相对时间”
  return dayjs().to(dt)
&#125;)
</code></pre></li></ol><h4 id="11懒加载"><a class="anchor" href="#11懒加载">#</a> 11. 懒加载</h4><ol><li><pre><code>import vant, &#123; Lazyload &#125; from 'vant'
</code></pre></li><li><pre><code>Vue.use(Lazyload)
</code></pre></li><li><p>在 <code>ArtItem.vue</code> 组件中，删除 <code>&lt;img&gt;</code> 标签的 <code>src</code> 属性，并应用 <code>v-lazy</code> 指令，指令的值是 <code>要展示的图片地址</code> ：</p><pre><code>&lt;!-- 单张图片 --&gt;
&lt;img alt=&quot;&quot; class=&quot;thumb&quot; v-if=&quot;article.cover.type === 1&quot; v-lazy=&quot;article.cover.images[0]&quot;&gt;

&lt;!-- 三张图片 --&gt;
&lt;div class=&quot;thumb-box&quot; v-if=&quot;article.cover.type === 3&quot;&gt;
  &lt;img alt=&quot;&quot; class=&quot;thumb&quot; v-for=&quot;(item, index) in article.cover.images&quot; :key=&quot;index&quot; v-lazy=&quot;item&quot;&gt;
&lt;/div&gt;
</code></pre></li></ol><h4 id="12子向父传值"><a class="anchor" href="#12子向父传值">#</a> 12. 子向父传值</h4><ol><li><pre><code>//在 ArtItem.vue 组件中，通过 this.$emit() 触发自定义事件，把要删除的文章 Id 传递给父组件：
// 一级选项的点击事件处理函数
async onCellClick(name) &#123;
  if (name === '不感兴趣') &#123;
    // 调用 API 接口，将文章设置为不感兴趣
    const &#123; data: res &#125; = await dislikeArticleAPI(this.artId)
    if (res.message === 'OK') &#123;
      // TODO：炸楼的操作，触发自定义的事件，将文章 id 发送给父组件
      this.$emit('remove-article', this.artId)
    &#125;
    this.show = false
  &#125;

  // 省略其它代码...
&#125;
</code></pre></li><li><pre><code>在 ArtList.vue 组件中使用 ArtItem.vue 组件时，监听 ArtItem.vue 组件的 @remove-article 事件：
&lt;!-- 循环渲染文章的列表 --&gt;
&lt;art-item
   v-for=&quot;item in artlist&quot;
   :key=&quot;item.art_id.toString()&quot;
   :article=&quot;item&quot;
   @remove-article=&quot;removeArticle&quot;
  &gt;
&lt;/art-item&gt;
</code></pre></li><li><pre><code>在 ArtList.vue 组件的 methods 中，声明 removeArticle 方法如下：
methods: &#123;
	removeArticle(id) &#123;
		this.artlist = this.artlist.filter(item =&gt; item.art_id.toString() !== id )
	&#125;
&#125;
</code></pre><blockquote><p>问题描述：炸楼之后，如果文章列表的数据不足以撑满整个屏幕，会导致上拉加载和下拉刷新不生效的问题</p><p>解决方案：每次炸楼之后，判断剩余数据的文章数量是否小于 10，如果小于 10，则主动请求下一页的数据</p></blockquote></li></ol><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>methods<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">// 从文章列表中移除指定 id 的文章</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">removeArticle</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 1. 炸楼操作</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>artlist <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>artlist<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>art_id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> id<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 2. 判断剩余数据的文章数量是否小于 10</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>artlist<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token comment">// 主动请求下一页的数据</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initArtList</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="13updatechannel-不会"><a class="anchor" href="#13updatechannel-不会">#</a> 13.updateChannel （不会）</h4><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>动态计算更多频道的数据</pre></td></tr><tr><td data-num="2"></td><td><pre>computed<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 更多频道的数据</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token function">moreChannels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 1. 对数组进行 filter 过滤，返回的是符合条件的新数组</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>allChannel<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token comment">// 判断当前循环项，是否在 “我的频道” 列表之中</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userChannel<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=></span> x<span class="token punctuation">.</span>id <span class="token operator">===</span> item<span class="token punctuation">.</span>id<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token comment">// 如果不在，则 return true，表示需要把这一项存储到返回的新数组之中</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr></table></figure><pre><code>methods: &#123;
  // 把用户的频道列表数据提交到后端保存
  async updateChannel(item) &#123;
    // 1. 准备要提交到服务器的数据
    const channels = this.userChannel
      .filter(item =&gt; item.name !== '推荐') // 将“推荐”从频道列表中过滤出去
      .map((item, index) =&gt; &#123;               // 调用数组的 map 循环，最终返回一个处理好的新数组
        return &#123;
          id: item.id,
          seq: index + 1
        &#125;
      &#125;)

    // 2. 调用 API 接口
    const &#123; data: res &#125; = await updateUserChannelAPI(channels)
    if (res.message === 'OK') &#123;
      // TODO：提示用户更新成功
    &#125;
  &#125;
&#125;
</code></pre><pre><code>methods: &#123;
  // 新增频道（形参 item 就是当前用户点击的频道信息对象）
  // 格式：&#123; id, name &#125;
  addChannel(item) &#123;
    // 将用户点击的频道，添加到“用户频道”列表中
    this.userChannel.push(item)

    // 调用 updateChannel 方法，把最新的频道列表数据提交到后端保存
    this.updateChannel()
  &#125;,
&#125;
</code></pre><h4 id="14实现输入框的防抖"><a class="anchor" href="#14实现输入框的防抖">#</a> 14. 实现输入框的防抖</h4><blockquote><p><strong>节流</strong>：单位时间内，重复的操作只会触发 1 次</p><p><strong>防抖</strong>：频繁触发某个操作时，仅触发最后 1 次</p></blockquote><pre><code>methods: &#123;
  // 搜索组件的输入事件
  onInput() &#123;
    // 2. 清除上次的延时器
    clearTimeout(this.timerId)
    
    // 3. 如果输入的内容为空，则 return 出去，不开启延时器
    if (this.kw.length === 0) return
    
    // 1. 开启延时器，将延时器的 id 存储到 this.timerId 中
    this.timerId = setTimeout(() =&gt; &#123;
      console.log(this.kw)
    &#125;, 500)
  &#125;
&#125;
</code></pre><pre><code>// 输入的搜索关键词为空
  if (this.kw.length === 0) &#123;
    // 清空搜索建议的列表数据
    this.suggestList = []
    return
  &#125;
</code></pre><h4 id="15高亮搜索关键词"><a class="anchor" href="#15高亮搜索关键词">#</a> 15. 高亮搜索关键词</h4><blockquote><p>要想实现搜索关键词的高亮效果，需要用到 字符串的 replace 方法以及正则表达式</p></blockquote><p>通过 <code>new RegExp()</code> 来<strong>动态创建</strong>正则表达式：</p><pre><code>// 关键词
const kw = 'js'
// 待处理的字符串
const str = 'JS ArrayBuffer about js'

// 1. 动态创建正则表达式
const reg = new RegExp(kw, 'ig')
// 2. 调用字符串的 replace 进行替换
const newStr = str.replace(reg, 'javascript')

// 3. 替换的结果 javascript ArrayBuffer about javascript
console.log(newStr)

// 缺点：无法拿到每一次正则匹配的结果
</code></pre><p>将 <code>replace</code> 方法的<strong>第二个参数</strong>指定为<strong>回调函数</strong>：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 关键词</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> kw <span class="token operator">=</span> <span class="token string">'js'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 待处理的字符串</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'JS ArrayBuffer about js'</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 1. 动态创建正则表达式</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>kw<span class="token punctuation">,</span> <span class="token string">'ig'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 2. 调用字符串的 replace 进行替换，第二个参数为回调函数。其中 val 是匹配到的值</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">const</span> newStr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>val<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/span></span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// 3. 替换的结果 &lt;span>JS&lt;/span> ArrayBuffer about &lt;span>js&lt;/span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newStr<span class="token punctuation">)</span></pre></td></tr></table></figure><p>实现关键词的高亮功能</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 高亮搜索关键词的方法，形参中的 arr 是搜索建议的数组</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">hlightKeywords</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 1. 根据用户输入的 kw，动态创建正则表达式</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kw<span class="token punctuation">,</span> <span class="token string">'ig'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// 循环数组中的每一项</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 2. 调用字符串的 replace 方法进行关键字的高亮处理</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span style="color: red; font-weight: bold;"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>val<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&lt;/span></span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="16跳转到搜索结果页"><a class="anchor" href="#16跳转到搜索结果页">#</a> 16. 跳转到搜索结果页</h4><p>e.currentTarget 是当正在触发事件的那个元素</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 跳转到搜索结果页</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">gotoSearchResult</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">//e.currentTarget 是当正在触发事件的那个元素</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment">// console.log(e.currentTarget.innerText)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// 1. 获取用户当前点击的搜索建议项的内容</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">const</span> kw <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>innerText</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">// 2. 通过编程式导航 API，跳转到搜索结果页</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/search/'</span> <span class="token operator">+</span> kw<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="17-将搜索关键词存为搜索历史"><a class="anchor" href="#17-将搜索关键词存为搜索历史">#</a> 17. 将搜索关键词存为搜索历史</h4><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 请求搜索建议列表数据的方法</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">async</span> <span class="token function">initSuggestList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 调用 API 接口</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token operator">:</span> res <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getSuggestListAPI</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kw<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>message <span class="token operator">===</span> <span class="token string">'OK'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 高亮搜索建议中的搜索关键词</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hlightKeywords</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>options<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 为 suggestList 数据赋值</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>suggestList <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>options</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 把搜索关键词加入到搜索历史中</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// 先保证没有再加</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">const</span> newHistory <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> item <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kw<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    newHistory<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kw<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> newHistory</pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr></table></figure><h4 id="18持久化存储搜索历史"><a class="anchor" href="#18持久化存储搜索历史">#</a> 18. 持久化存储搜索历史</h4><pre><code>watch: &#123;
  // 监视历史记录的变化
  history(newVal) &#123;
    // 持久化存储到本地
    localStorage.setItem('history', JSON.stringify(newVal))
  &#125;
&#125;
</code></pre><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 省略其它数据项...</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 搜索历史</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    history<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'history'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'[]'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>19. 评论自动获得焦点</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 展示第二个评论区域</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">showBox2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 隐藏评论区域 1，展示评论区域 2</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">this</span><span class="token punctuation">.</span>isShowBox1 <span class="token operator">=</span> <span class="token boolean">false</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// 1. 将回调函数延迟到下次 DOM 更新完毕之后执行</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 2. 通过 ref 获取到 textarea 的引用</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>iptCmt<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr></table></figure><h4 id="19-初始化用户的基本信息"><a class="anchor" href="#19-初始化用户的基本信息">#</a> 19. 初始化用户的基本信息</h4><pre><code>action: &#123;
	async initUserInfo(ctx) &#123;
		const &#123; data: res &#125; = await getUserInfoAPI()
		if(res.message === 'OK') &#123;
		ctx.commit('updateUserInfo', res.data)
		&#125;
	&#125;
&#125;
</code></pre><h4 id="20渲染退出登录的确认提示框"><a class="anchor" href="#20渲染退出登录的确认提示框">#</a> 20. 渲染退出登录的确认提示框</h4><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 点击了退出登录</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">async</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 展示确认的提示框</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">const</span> confirmResult <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$dialog</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      title<span class="token operator">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      message<span class="token operator">:</span> <span class="token string">'确认退出登录吗？'</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token comment">//err 是错误的结果</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token comment">// 这里把 err return 给了 confirmResult</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token keyword">return</span> err</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token comment">// 如果点击了取消，则不执行后续的操作</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>confirmResult <span class="token operator">===</span> <span class="token string">'cancel'</span><span class="token punctuation">)</span> <span class="token keyword">return</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token comment">// TODO：实现退出的登录操作：</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token comment">// 1. 清空 vuex 中的数据</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token comment">// 2. 清空本地的数据</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanState</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token comment">// 3. 跳转到登录页</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="21-更新用户的简介信息"><a class="anchor" href="#21-更新用户的简介信息">#</a> 21. 更新用户的简介信息</h4><p>如果请求接口失败，且报错的消息是 <code>409 (CONFLICT)</code> ，则证明当前提交的名称被占用了，需要进行 <code>try...catch</code> 的处理：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 更新用户的简介信息</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">async</span> <span class="token function">updateName</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token operator">:</span> res <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">updateUserProfileAPI</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>message <span class="token operator">===</span> <span class="token string">'OK'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token comment">// 关闭对话框</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token comment">// 重新请求用户的简介信息</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token comment">// 提示用户更新成功</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$notify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'名称更新成功！'</span><span class="token punctuation">,</span> duration<span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">409</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token comment">// 提示用户名称被占用</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$notify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'名称被占用，请更换后重试！'</span><span class="token punctuation">,</span> duration<span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token comment">// 阻止关闭对话框</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token function">done</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token comment">// 让文本框持续获得焦点</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>nameRef<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token comment">// 关闭对话框</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token comment">// 提示用户名称被占用</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$notify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'danger'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'名称更新失败！'</span><span class="token punctuation">,</span> duration<span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="22修改头像"><a class="anchor" href="#22修改头像">#</a> 22. 修改头像</h4><p>点击头像时展示文件选择框</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- 文件选择框 --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image/*<span class="token punctuation">"</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onFileChange<span class="token punctuation">"</span></span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileRef<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr></table></figure><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- 用户的头像 --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-image</span> <span class="token attr-name">round</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>avatar<span class="token punctuation">"</span></span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userProfile.photo<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$refs.fileRef.click()<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 选中的文件发生了变化</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">async</span> <span class="token function">onFileChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 获取到用户选择的文件列表</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">const</span> files <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>files</pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">// 如果没有选择任何文件，则不执行后续的业务逻辑</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// 1.1 创建 FormData 的对象</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">const</span> fd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token comment">// 1.2 向 fd 中追加数据项</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  fd<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'photo'</span><span class="token punctuation">,</span> files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token comment">// 2. 调用 API 接口，更新头像</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token operator">:</span> res <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">updateUserAvatarAPI</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>message <span class="token operator">===</span> <span class="token string">'OK'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">// 2.1 更新用户的简介信息</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">// 2.2 提示用户更新成功</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$notify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'更新头像成功！'</span><span class="token punctuation">,</span> duration<span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="23socketio-client-的基本使用"><a class="anchor" href="#23socketio-client-的基本使用">#</a> 23.socket.io-client 的基本使用</h4><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> i socket.io-client@4.0.0 -S</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 如果 npm 无法成功安装 socket.io-client，可以尝试用 yarn 来装包</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># yarn add socket.io-client@4.0.0</span></pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 按需导入 io 方法：调用 io ('url') 方法，即可创建 websocket 连接的实例</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> io <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'socket.io-client'</span></pre></td></tr></table></figure><p>事先定义变量 socket，用来接收 io () 方法创建的 socket 实例：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> socket <span class="token operator">=</span> <span class="token keyword">null</span></pre></td></tr></table></figure><p>在 <code>Chat.vue</code> 组件的 <code>created</code> 生命周期函数中，创建 websocket 实例对象：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">// 创建客户端 websocket 的实例</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  socket <span class="token operator">=</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token string">'ws://www.liulongbin.top:9999'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在 <code>Chat.vue</code> 组件的 <code>beforeDestroy</code> 生命周期函数中，<strong>关闭 websocket 连接</strong>并<strong>销毁 websocket 实例对象</strong>：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 组件被销毁之前，清空 sock 对象</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 关闭连接</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// 销毁 websocket 实例对象</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  socket <span class="token operator">=</span> <span class="token keyword">null</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在 <code>Chat.vue</code> 组件的 <code>created</code> 生命周期函数中，调用 <code>socket.on('connect', fn)</code> 方法，可以监听到 socket 连接成功的事件：调用 <code>socket.on('disconnect', fn)</code> 方法，可以监听到 socket 连接关闭的事件：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 建立连接的事件</span></pre></td></tr><tr><td data-num="2"></td><td><pre>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'connect: websocket 连接成功！'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 关闭连接的事件</span></pre></td></tr><tr><td data-num="2"></td><td><pre>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'disconnect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'disconnect: websocket 连接关闭！'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>接收服务器发送的消息</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 接收到消息的事件</span></pre></td></tr><tr><td data-num="2"></td><td><pre>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">msg</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 接收到消息的事件</span></pre></td></tr><tr><td data-num="2"></td><td><pre>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">msg</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 把服务器发送过来的消息，存储到 list 数组中</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">'xs'</span><span class="token punctuation">,</span> msg <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>客户端调用 <code>socket.emit('send', '消息内容')</code> 方法，即可向 websocket 服务器发送消息：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 提交按钮的点击事件处理函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 如果输入的聊天内容为空，则 return 出去</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>word<span class="token punctuation">)</span> <span class="token keyword">return</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// 向服务器发送消息</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'send'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>word<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// 将用户填写的消息存储到 list 数组中</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">'me'</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>word <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token comment">// 清空文本框中的消息内容</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">this</span><span class="token punctuation">.</span>word <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="24elementscrollintoview"><a class="anchor" href="#24elementscrollintoview">#</a> 24.Element.scrollIntoView()</h4><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 滚动到页面底部</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">scrollToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 1. 获取到所有的聊天 Item 项</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">const</span> chatItem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.chat-item'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">// 2. 获取到最后一项对应的 DOM 元素</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">const</span> lastItem <span class="token operator">=</span> chatItem<span class="token punctuation">[</span>chatItem<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// 3. 滚动元素的父容器，使被调用 scrollIntoView () 的元素对用户可见</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  lastItem<span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    behavior<span class="token operator">:</span> <span class="token string">'smooth'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 定义垂直方向的对齐（end 表示元素的底端将和其所在滚动区的可视区域的底端对齐）</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    block<span class="token operator">:</span> <span class="token string">'end'</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在 <code>Chat.vue</code> 组件中定义 <code>watch</code> 侦听器，监视 <code>list</code> 数组的变化，从而自动滚动到页面底部：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>watch<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 监视到 list 数据变化后，等 DOM 更新完毕，再执行滚动到底部的操作</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">scrollToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="25全局前置守卫"><a class="anchor" href="#25全局前置守卫">#</a> 25. 全局前置守卫</h4><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 所有有权限页面的路径，都在这个数组之中</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> pagePathArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token string">'/user/edit'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 为路由的实例对象挂载全局前置守卫</span></pre></td></tr><tr><td data-num="5"></td><td><pre>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>pagePathArr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 访问的是有权限的页面，需要判断用户是否登录</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 访问的是没有权限的页面</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 所有有权限页面的路径，都在这个数组之中</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> pagePathArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token string">'/user/edit'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 为路由的实例对象挂载全局前置守卫</span></pre></td></tr><tr><td data-num="5"></td><td><pre>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// 访问的是有权限的页面，需要判断用户是否登录</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>pagePathArr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 1. 从 store 中获取 token 的值</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">//    注意：store.state.tokenInfo 要么是 &#123;&#125; 空对象，要么是包含 &#123;token, refresh_token&#125; 的对象</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">const</span> tokenStr <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>tokenInfo<span class="token punctuation">.</span>token</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>tokenStr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token comment">// 1.1 token 有值，已登录过（操作：直接放行）</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token comment">// 1.2 token 不存在，没有登录（操作：强制跳转到登录页）</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// 访问的是没有权限的页面</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="26-记录上次访问未遂的路由地址"><a class="anchor" href="#26-记录上次访问未遂的路由地址">#</a> 26. 记录上次访问未遂的路由地址</h4><blockquote><p>如果用户没有登录，要访问 /user 地址，则会强制跳转到 /login 登录页</p><p>当用户登录成功之后，应该自动跳转到用户刚才访问未遂的路由地址，即：登录成功之后，跳转到 /user</p></blockquote><p>1. 在路由模块的导航守卫中，修改强制跳转到登录的代码：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//before：没有登录，强制跳转到登录页</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//now：没有登录，强制跳转到登录页，并携带路由的 "query 查询参数"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">next</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/login?pre=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>to<span class="token punctuation">.</span>fullPath<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>2. 在 <code>/src/views/Login/Login.vue</code> 组件中，进一步改造登录的方法：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">// 只有当表单数据校验通过之后，才会调用此 login 函数</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token operator">:</span> res <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loginAPI</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">// 判断是否登录成功了</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>message <span class="token operator">===</span> <span class="token string">'OK'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 1. 把登录成功的结果，存储到 vuex 中</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateTokenInfo</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 2. 要跳转到首页</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">const</span> navPath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>pre <span class="token operator">||</span> <span class="token string">'/'</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>navPath<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="27-token-续签"><a class="anchor" href="#27-token-续签">#</a> 27. Token 续签</h4><blockquote><p>两种主流方案：</p><ol><li>只要发现 Token 过期，则<strong>强制用户跳转到登录页</strong>，并清空<strong>本地</strong>和 <strong>Vuex</strong> 中的关键数据！</li><li>如果发现 Token 过期，则自动基于 refresh_token <strong>无感知地请求一个新 Token 回来</strong>。在替换掉旧 Token 的同时，继续上次未完成的请求！</li></ol></blockquote><p>方案 1：强制跳转到登录页</p><pre><code>// 响应拦截器
instance.interceptors.response.use(
  response =&gt; &#123;
    // 隐藏 loading 提示效果
    Toast.clear()
    return response
  &#125;,
  error =&gt; &#123;
    // 在请求失败的时候，关闭 loading 提示效果
    Toast.clear()

    // 如果有响应的结果，并且响应的状态码是 401，则证明 Token 过期了
    if (error.response &amp;&amp; error.response.status === 401) &#123;
      console.log('token 过期啦')
      // TODO1：清空 vuex 和 localStorage 中的数据
      // TODO2：强制跳转到登录页，并通过路由的 query 查询参数，把当前用户访问未遂的路由地址带给登录页
    &#125;
    return Promise.reject(error)
  &#125;
)
</code></pre><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 如果有响应的结果，并且响应的状态码是 401，则证明 Token 过期了</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'token 过期啦'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment">// TODO1：清空 vuex 和 localStorage 中的数据</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'cleanState'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// TODO2：强制跳转到登录页，并通过路由的 query 查询参数，把当前用户 “访问未遂的路由地址” 带给登录页</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/login?pre='</span> <span class="token operator">+</span> router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>fullPath<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>方案 2：无感知刷新 Token</p><p><img data-src="http://doc.toutiao.liulongbin.top/assets/img/13-1.ccdb8ae9.png" alt="img"></p><p>在响应拦截器中监听 Token 过期的情况</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 响应拦截器</span></pre></td></tr><tr><td data-num="2"></td><td><pre>instance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token parameter">response</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 隐藏 loading 提示效果</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    Toast<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> response</pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    Toast<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 1. 从 vuex 中获取 tokenInfo 对象，格式为： &#123;token, refresh_token&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">const</span> tokenInfo <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>tokenInfo</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">// 2. 判断是否为 token 过期</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span> <span class="token operator">&amp;&amp;</span> tokenInfo<span class="token punctuation">.</span>refresh_token<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token comment">//token 过期</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'token过期啦'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token comment">// 3.1 TODO: 发起请求，根据 refresh_token 重新请求一个有效的新 token</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>在请求新 Token 时，不要基于 <code>/src/utils/request.js</code> 模块中的 instance 发起请求，</p><p>因为 instance 发起请求时，默认携带的 Authorization 值为 tokenInfo.token 属性！！！</p></blockquote><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 换取 Token 的 API（形参中的 refreshToken 用来换取新 token）</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">exchangeTokenAPI</span> <span class="token operator">=</span> <span class="token parameter">refreshToken</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">return</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    method<span class="token operator">:</span> <span class="token string">'PUT'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 这里必须填写完整的请求 URL 地址</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    url<span class="token operator">:</span> <span class="token string">'http://www.liulongbin.top:8000/v1_0/authorizations'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    headers<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token comment">// 在请求头中携带 Authorization 身份认证字段</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      Authorization<span class="token operator">:</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> refreshToken</pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>重新调用刚才请求未遂的接口，处理 refresh_token 失效的情况</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 响应拦截器</span></pre></td></tr><tr><td data-num="2"></td><td><pre>instance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token parameter">response</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 隐藏 loading 提示效果</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    Toast<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> response</pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">async</span> <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    Toast<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 1. 从 vuex 中获取 tokenInfo 对象，格式为： &#123;token, refresh_token&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">const</span> tokenInfo <span class="token operator">=</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>tokenInfo</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// 2. 判断是否为 token 过期</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span> <span class="token operator">&amp;&amp;</span> tokenInfo<span class="token punctuation">.</span>refresh_token<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token comment">//token 过期</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'token过期啦'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token comment">// 3.1 TODO: 发起请求，根据 refresh_token 重新请求一个有效的新 token</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token operator">:</span> res <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">exchangeTokenAPI</span><span class="token punctuation">(</span>tokenInfo<span class="token punctuation">.</span>refresh_token<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token comment">// 3.2 TODO: 更新 Store 中的 Token</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'updateTokenInfo'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> token<span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">,</span> refresh_token<span class="token operator">:</span> tokenInfo<span class="token punctuation">.</span>refresh_token <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token comment">// 3.3 重新调用刚才 “请求未遂” 的接口</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token comment">// 3.3.1 如果在响应拦截器中 return 一个新的 Promise 异步请求，则会把这次请求的结果，当作上次请求的返回值</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">return</span> <span class="token function">instance</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>config<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token comment">//  token 和 refresh_token 都失效了</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token comment">// 4.1 清空 vuex 和 localStorage</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'cleanState'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token comment">// 4.2 强制跳转到登录页</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/login?pre='</span> <span class="token operator">+</span> router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>fullPath<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>error.config</code> 就是上一次的请求信息</p><h4 id="28实现-main-组件的状态保持"><a class="anchor" href="#28实现-main-组件的状态保持">#</a> 28. 实现 Main 组件的状态保持</h4><p>详情页也被缓存了，导致了文章数据不会动态刷新的问题。定义 <code>watch</code> 侦听器来监视 <code>props</code> 中 <code>id</code> 值的变化，从而动态请求文章的详情数据：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>watch<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 只要 id 值发生了变化，就清空旧的文章信息</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>article <span class="token operator">=</span> <span class="token keyword">null</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 并重新获取文章的详情数据</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initArticleInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr></table></figure><h4 id="29实现-home-组件的状态保持"><a class="anchor" href="#29实现-home-组件的状态保持">#</a> 29. 实现 Home 组件的状态保持</h4><p><code>User.vue</code> 组件也被缓存了，导致修改用户头像后，头像不刷新的问题。可以在被缓存的 <code>User.vue</code> 组件中，声明 <code>activated</code> 和 <code>deactivated</code> 声明周期函数，来监听组件<strong>被激活</strong>和<strong>被缓存</strong>的状态变化：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">// 把下面这一行注释掉，因为 activated 在组件首次加载时也会调用一次</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// this.initUserInfo()</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 被激活了</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">activated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// 只要组件被激活了，就重新初始化用户的信息</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr></table></figure><h4 id="30实现-searchresult-组件的状态保持"><a class="anchor" href="#30实现-searchresult-组件的状态保持">#</a> 30. 实现 SearchResult 组件的状态保持</h4><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>watch<span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function">kw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 1. 重置关键数据</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>page <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>artList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span>finished <span class="token operator">=</span> <span class="token boolean">false</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    </pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 2. 请求数据</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initSearchResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr></table></figure><h4 id="31记录首页文章列表的滚动位-无效"><a class="anchor" href="#31记录首页文章列表的滚动位-无效">#</a> 31. 记录首页文章列表的滚动位 无效</h4><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  path<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  component<span class="token operator">:</span> Home<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  name<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  meta<span class="token operator">:</span> <span class="token punctuation">&#123;</span> isRecord<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在 <code>Home.vue</code> 组件中，声明 <code>beforeRouteLeave</code> 这个<strong>组件内的守卫</strong>，用来记录当前组件在纵向上滚动的距离：</p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">beforeRouteLeave</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  from<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>top <span class="token operator">=</span> window<span class="token punctuation">.</span>scrollY</pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 全局后置钩子</span></pre></td></tr><tr><td data-num="2"></td><td><pre>router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 如果当前的路由的元信息中，isRecord 的值为 true</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>isRecord<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token comment">// 则把元信息中的 top 值设为滚动条纵向滚动的位置</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>top<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><ol><li>新建 API</li><li>导入</li><li>声明数据</li><li>定义方法</li><li>在 created 中调用方法</li></ol><div class="tags"><a href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag"><i class="ic i-tag"></i> 前端</a> <a href="/tags/Vue/" rel="tag"><i class="ic i-tag"></i> Vue</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-04-23 14:42:08" itemprop="dateModified" datetime="2022-04-23T14:42:08+08:00">2022-04-23</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="sparkle 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="sparkle 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="sparkle 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>sparkle <i class="ic i-at"><em>@</em></i>Sparkle</li><li class="link"><strong>本文链接：</strong> <a href="https://1234cas.github.io/1234cas.github.io/Front-end/Vue/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E7%AC%94%E8%AE%B0/" title="黑马头条笔记">https://1234cas.github.io/1234cas.github.io/Front-end/Vue/黑马头条笔记/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/Front-end/Vue/vue%E9%9D%A2%E8%AF%95%E9%A2%98/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipev1x5e4j20zk0m8b29.jpg" title="Vue面试题"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Vue</span><h3>Vue面试题</h3></a></div><div class="item right"><a href="/Front-end/Vue/vue%E7%AC%94%E8%AE%B0/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclhfehz7j20zk0m8u0x.jpg" title="Vue笔记"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Vue</span><h3>Vue笔记</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AEaxios"><span class="toc-number">1.</span> <span class="toc-text">1. 安装和配置 axios</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E8%A6%86%E7%9B%96%E9%BB%98%E8%AE%A4%E6%A0%B7%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">2. 覆盖默认样式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">3.</span> <span class="toc-text">3. 登录功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4token%E7%9A%84%E5%AD%98%E5%82%A8"><span class="toc-number">4.</span> <span class="toc-text">4.token 的存储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8state"><span class="toc-number">5.</span> <span class="toc-text">5. 持久化存储 state</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6axios%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">6.axios 拦截器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E5%88%9D%E6%AD%A5%E5%B0%81%E8%A3%85-artlist-%E7%BB%84%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">7. 初步封装 ArtList 组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E4%B8%8A%E6%8B%89%E5%8A%A0%E8%BD%BD"><span class="toc-number">8.</span> <span class="toc-text">8. 上拉加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0"><span class="toc-number">9.</span> <span class="toc-text">9. 下拉刷新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10dayjs"><span class="toc-number">10.</span> <span class="toc-text">10.day.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-number">11.</span> <span class="toc-text">11. 懒加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12%E5%AD%90%E5%90%91%E7%88%B6%E4%BC%A0%E5%80%BC"><span class="toc-number">12.</span> <span class="toc-text">12. 子向父传值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13updatechannel-%E4%B8%8D%E4%BC%9A"><span class="toc-number">13.</span> <span class="toc-text">13.updateChannel （不会）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14%E5%AE%9E%E7%8E%B0%E8%BE%93%E5%85%A5%E6%A1%86%E7%9A%84%E9%98%B2%E6%8A%96"><span class="toc-number">14.</span> <span class="toc-text">14. 实现输入框的防抖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15%E9%AB%98%E4%BA%AE%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E8%AF%8D"><span class="toc-number">15.</span> <span class="toc-text">15. 高亮搜索关键词</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E9%A1%B5"><span class="toc-number">16.</span> <span class="toc-text">16. 跳转到搜索结果页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#17-%E5%B0%86%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E8%AF%8D%E5%AD%98%E4%B8%BA%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2"><span class="toc-number">17.</span> <span class="toc-text">17. 将搜索关键词存为搜索历史</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#18%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2"><span class="toc-number">18.</span> <span class="toc-text">18. 持久化存储搜索历史</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#19-%E5%88%9D%E5%A7%8B%E5%8C%96%E7%94%A8%E6%88%B7%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">19.</span> <span class="toc-text">19. 初始化用户的基本信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#20%E6%B8%B2%E6%9F%93%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E7%9A%84%E7%A1%AE%E8%AE%A4%E6%8F%90%E7%A4%BA%E6%A1%86"><span class="toc-number">20.</span> <span class="toc-text">20. 渲染退出登录的确认提示框</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#21-%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E7%9A%84%E7%AE%80%E4%BB%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">21.</span> <span class="toc-text">21. 更新用户的简介信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22%E4%BF%AE%E6%94%B9%E5%A4%B4%E5%83%8F"><span class="toc-number">22.</span> <span class="toc-text">22. 修改头像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23socketio-client-%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">23.</span> <span class="toc-text">23.socket.io-client 的基本使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#24elementscrollintoview"><span class="toc-number">24.</span> <span class="toc-text">24.Element.scrollIntoView()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#25%E5%85%A8%E5%B1%80%E5%89%8D%E7%BD%AE%E5%AE%88%E5%8D%AB"><span class="toc-number">25.</span> <span class="toc-text">25. 全局前置守卫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#26-%E8%AE%B0%E5%BD%95%E4%B8%8A%E6%AC%A1%E8%AE%BF%E9%97%AE%E6%9C%AA%E9%81%82%E7%9A%84%E8%B7%AF%E7%94%B1%E5%9C%B0%E5%9D%80"><span class="toc-number">26.</span> <span class="toc-text">26. 记录上次访问未遂的路由地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#27-token-%E7%BB%AD%E7%AD%BE"><span class="toc-number">27.</span> <span class="toc-text">27. Token 续签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#28%E5%AE%9E%E7%8E%B0-main-%E7%BB%84%E4%BB%B6%E7%9A%84%E7%8A%B6%E6%80%81%E4%BF%9D%E6%8C%81"><span class="toc-number">28.</span> <span class="toc-text">28. 实现 Main 组件的状态保持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#29%E5%AE%9E%E7%8E%B0-home-%E7%BB%84%E4%BB%B6%E7%9A%84%E7%8A%B6%E6%80%81%E4%BF%9D%E6%8C%81"><span class="toc-number">29.</span> <span class="toc-text">29. 实现 Home 组件的状态保持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#30%E5%AE%9E%E7%8E%B0-searchresult-%E7%BB%84%E4%BB%B6%E7%9A%84%E7%8A%B6%E6%80%81%E4%BF%9D%E6%8C%81"><span class="toc-number">30.</span> <span class="toc-text">30. 实现 SearchResult 组件的状态保持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#31%E8%AE%B0%E5%BD%95%E9%A6%96%E9%A1%B5%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E7%9A%84%E6%BB%9A%E5%8A%A8%E4%BD%8D-%E6%97%A0%E6%95%88"><span class="toc-number">31.</span> <span class="toc-text">31. 记录首页文章列表的滚动位 无效</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/Front-end/Vue/vue-router/" rel="bookmark" title="Vue router">Vue router</a></li><li><a href="/Front-end/Vue/vuex/" rel="bookmark" title="vuex">vuex</a></li><li><a href="/Front-end/Vue/vue%E7%AC%94%E8%AE%B0/" rel="bookmark" title="Vue笔记">Vue笔记</a></li><li class="active"><a href="/Front-end/Vue/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E7%AC%94%E8%AE%B0/" rel="bookmark" title="黑马头条笔记">黑马头条笔记</a></li><li><a href="/Front-end/Vue/vue%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="bookmark" title="Vue面试题">Vue面试题</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="sparkle" data-src="/images/avatar.jpg"><p class="name" itemprop="name">sparkle</p><div class="description" itemprop="description">好好读书</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">35</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">13</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">11</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span> <span class="exturl item google" data-url="aHR0cHM6Ly9wbHVzLmdvb2dsZS5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;plus.google.com&#x2F;yourname"><i class="ic i-google"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnlvdXJuYW1lQG1haWwuY29t" title="mailto:yourname@mail.com"><i class="ic i-envelope"></i></span> <span class="exturl item facebook" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;www.facebook.com&#x2F;yourname"><i class="ic i-facebook"></i></span> <span class="exturl item stackoverflow" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;stackoverflow.com&#x2F;yourname"><i class="ic i-stack-overflow"></i></span> <span class="exturl item youtube" data-url="aHR0cHM6Ly95b3V0dWJlLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;youtube.com&#x2F;yourname"><i class="ic i-youtube"></i></span> <span class="exturl item instagram" data-url="aHR0cHM6Ly9pbnN0YWdyYW0uY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;instagram.com&#x2F;yourname"><i class="ic i-instagram"></i></span> <span class="exturl item skype" data-url="c2t5cGU6eW91cm5hbWU/Y2FsbHxjaGF0" title="skype:yourname?call|chat"><i class="ic i-skype"></i></span> <span class="exturl item douban" data-url="aHR0cHM6Ly93d3cuZG91YmFuLmNvbS9wZW9wbGUveW91cm5hbWUv" title="https:&#x2F;&#x2F;www.douban.com&#x2F;people&#x2F;yourname&#x2F;"><i class="ic i-douban"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>链接</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/Front-end/Vue/vue%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/Front-end/Vue/vue%E7%AC%94%E8%AE%B0/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Reading-minutes/" title="分类于 读书笔记">读书笔记</a></div><span><a href="/Reading-minutes/%E5%85%B3%E4%BA%8E%E7%AC%94%E8%AE%B0/" title="关于笔记">关于笔记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%97%A5%E8%AE%B0/" title="分类于 日记">日记</a></div><span><a href="/Diary/2022-4-3/" title="2022-4-3">2022-4-3</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%85%B6%E4%BB%96/" title="分类于 其他">其他</a></div><span><a href="/Other/%E6%94%B6%E8%97%8F-%E5%AD%97%E9%9D%A2%E8%AE%B0%E5%BD%95/" title="收藏">收藏</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Front-end/" title="分类于 前端">前端</a></div><span><a href="/Front-end/%E6%97%A9%E6%9C%9F%E7%AC%94%E8%AE%B0/" title="早期笔记">早期笔记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Front-end/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/Front-end/%E4%B8%80%E6%96%B9%E9%9D%A2/" title="分类于 一方面">一方面</a></div><span><a href="/Front-end/One-side/MouseEvent/" title="MouseEvent">MouseEvent</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" title="分类于 编程笔记">编程笔记</a></div><span><a href="/Coding-diary/2022-4-1/" title="2022-4-1">2022-4-1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%97%A5%E8%AE%B0/" title="分类于 日记">日记</a></div><span><a href="/Diary/2021-11-14/" title="2022-11-14.">2022-11-14.</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a></div><span><a href="/Algorithms/leetcode%E7%AE%97%E6%B3%95%E9%A2%98%E7%AC%94%E8%AE%B0/" title="leetcode算法笔记">leetcode算法笔记</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/Algorithms/%E5%89%91%E6%8C%87offer/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Front-end/" title="分类于 前端">前端</a> <i class="ic i-angle-right"></i> <a href="/categories/Front-end/ES6/" title="分类于 ES6">ES6</a></div><span><a href="/Front-end/ES6/ES6%E4%B8%8A/" title="ES6上">ES6上</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">sparkle @ Sparkle</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">681k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">10:20</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"Front-end/Vue/黑马头条笔记/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:{placeholder:"1. 提问前请先仔细阅读本文档⚡\n2. 页面显示问题💥，请提供控制台截图📸或者您的测试网址\n3. 其他任何报错💣，请提供详细描述和截图📸，祝食用愉快💪"},fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->